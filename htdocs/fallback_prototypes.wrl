#VRML V2.0 utf8

# -----------------------------------------------------------------------------
# This VRML file specifies "fallback" prototypes for extensions
# of Castle Game Engine,
# [https://castle-engine.io/x3d_extensions.php].
#
# This file will *not* be used by Castle Game Engine programs
# (like Castle Model Viewer), as they have appropriate nodes simply built-in.
#
# This file may be used by other VRML browsers so that they are able
# to partially understand these extension nodes, or at least omit them
# gracefully.
# -----------------------------------------------------------------------------

# Text with depth (thickness) so it looks nice in 3D.
# Deprecated Castle Game Engine extension, rendered as just flat text now.
# See https://castle-engine.io/x3d_implementation_text_extensions.php#section_ext_text3d .
PROTO Text3D [
  exposedField MFString string []
  exposedField SFNode fontStyle NULL
  exposedField MFFloat length []
  exposedField SFFloat maxExtent 0
  exposedField SFFloat depth 0.1
  exposedField SFBool solid TRUE
] {
  Text {
    string IS string
    fontStyle IS fontStyle
    length IS length
    maxExtent IS maxExtent
  }
}

# Appearance with Castle Game Engine extensions.
# Deprecated, usually you can use just Appearance node (with CGE extension
# fields) which is simpler.
PROTO KambiAppearance [
  exposedField SFNode material          NULL
  exposedField SFNode texture           NULL
  exposedField SFNode textureTransform  NULL

  # X3D fields
  exposedField SFNode fillProperties    NULL
  exposedField SFNode lineProperties    NULL
  exposedField SFNode metadata          NULL
  exposedField MFNode shaders           []

  # Castle Game Engine extensions
  exposedField SFNode normalMap         NULL
  exposedField SFNode heightMap         NULL
  exposedField SFFloat heightMapScale   0.01
  exposedField SFNode blendMode         NULL
  exposedField SFBool shadowCaster      TRUE
] {
  Appearance {
    material IS material
    texture IS texture
    textureTransform IS textureTransform
  }
}

# How blending should be applied.
# Castle Game Engine extension, compatible with InstantReality.
# See https://castle-engine.io/x3d_extensions.php#section_ext_blending .
PROTO BlendMode [
  exposedField SFString srcFactor "src_alpha"
  exposedField SFString destFactor "one_minus_src_alpha"
  exposedField SFColor color 1 1 1
  exposedField SFFloat colorTransparency 0
] {
  Group { } # expand to nothing, just ignore this node if you can't handle it natively
}

# Specify how some shapes (like spheres, cylinders) are triangulated.
# Deprecated Castle Game Engine extension,
# instead use simple fields like Sphere.slices, Sphere.stacks.
# See about the recommended way to achieve this:
# https://castle-engine.io/x3d_implementation_geometry3d_extensions.php#section_triangulation .
PROTO KambiTriangulation [
  exposedField SFInt32    quadricSlices    -1     # {-1} + [3, infinity)
  exposedField SFInt32    quadricStacks    -1     # {-1} + [2, infinity)
  exposedField SFInt32    rectDivisions    -1     # [-1, infinity)
] {
  Group { } # expand to nothing, just ignore this node if you can't handle it natively
}

# Inline with optional node replacements.
# Deprecated Castle Game Engine extension.
# See https://castle-engine.io/x3d_extensions.php#section_ext_kambi_inline .
PROTO KambiInline [
  exposedField MFString url        []
  field        SFVec3f  bboxCenter 0 0 0
  field        SFVec3f  bboxSize   -1 -1 -1
  exposedField MFString    replaceNames  []
  exposedField MFNode      replaceNodes  []
] {
  Inline {
    url IS url
    bboxCenter IS bboxCenter
    bboxSize IS bboxSize
  }
}

# Specify transformation as explicit 4x4 matrix.
# This is a Castle Game Engine extension,
# compatible with various other X3D browsers.
# Deprecated: instead of this, use standard Transform as much as possible.
# See https://castle-engine.io/x3d_extensions.php#section_ext_matrix_transform .
PROTO MatrixTransform [
  exposedField     MFNode     children     []
  field            SFVec3f    bboxCenter   0 0 0
  field            SFVec3f    bboxSize     -1 -1 -1
  exposedField     SFMatrix4f matrix       1 0 0 0
                                           0 1 0 0
                                           0 0 1 0
                                           0 0 0 1
] {
  Group {
    children IS children
    bboxCenter IS bboxCenter
    bboxSize IS bboxSize
  }
}

# Show a teapot.
# Deprecated Castle Game Engine extension, compatible with InstantReality.
# See https://castle-engine.io/x3d_extensions.php#section_ext_teapot .
PROTO Teapot [
  field SFVec3f size      3 3 3
  field SFBool  solid     TRUE
  field SFBool  manifold  FALSE
  exposedField SFNode  texCoord NULL # only TextureCoordinateGenerator
] {
  # This could be expanded to
  #   Transform {
  #     scale IS size
  #     children IndexedFaceSet {
  #       solid IS solid
  #       .... teapot data in coord, coordIndex etc. ....
  #     }
  #   }
  #
  # For now expand to nothing, just ignore this node if you can't
  # handle it natively.

  Group { }
}

# NavigationInfo with Castle Game Engine extensions.
# Deprecated, usually you can use just NavigationInfo node (with CGE extension
# fields) which is simpler.
# See https://castle-engine.io/x3d_implementation_navigation_extensions.php .
PROTO KambiNavigationInfo [

  # Standard VRML 97 NavigationInfo fields/events
  eventIn      SFBool   set_bind
  exposedField MFFloat  avatarSize      [0.25 1.6 0.75]
  exposedField SFBool   headlight       TRUE
  exposedField SFFloat  speed           1.0
  exposedField MFString type            ["WALK" "ANY"]
  exposedField SFFloat  visibilityLimit 0.0
  eventOut     SFBool   isBound

  # Castle Game Engine extensions
  field SFBool  timeOriginAtLoad       FALSE
  field SFNode  octreeRendering            NULL
  field SFNode  octreeDynamicCollisions    NULL
  field SFNode  octreeVisibleTriangles     NULL
  field SFNode  octreeCollidableTriangles  NULL
  field SFNode  octreeStaticCollisions     NULL
  exposedField SFNode  headlightNode       NULL
] {
  NavigationInfo {
    set_bind              IS  set_bind
    avatarSize            IS  avatarSize
    headlight             IS  headlight
    speed                 IS  speed
    type                  IS  type
    visibilityLimit       IS  visibilityLimit
    isBound               IS  isBound
  }
}

# Shadow map parameters, like size and frequency of updates.
# This is a Castle Game Engine extension.
# See https://castle-engine.io/x3d_extensions_shadow_maps.php .
PROTO GeneratedShadowMap [
  exposedField SFNode    metadata         NULL
  exposedField SFString  update           "NONE"
  field        SFInt32   size             128
  field        SFNode    light            NULL
  exposedField SFFloat   scale            1.1
  exposedField SFFloat   bias             4.0
  field        SFString  compareMode      "COMPARE_R_LEQUAL"
] {
  ImageTexture { }
}

# Texture with contents created by rendering the scene from a specific
# viewpoint.
# This is a Castle Game Engine extension compatible with other X3D browsers.
# See https://castle-engine.io/x3d_implementation_texturing_extensions.php#section_ext_rendered_texture .
PROTO RenderedTexture [
  exposedField    SFNode    metadata              NULL
  exposedField    MFInt32   dimensions            [128 128 4 1 1]
  exposedField    SFString  update                "NONE"
  exposedField    SFNode    viewpoint             NULL
  field           SFNode    textureProperties     NULL
  field           SFBool    repeatS               TRUE
  field           SFBool    repeatT               TRUE
  field           SFBool    repeatR               TRUE
  exposedField    MFBool    depthMap              []
] {
  ImageTexture { }
}
