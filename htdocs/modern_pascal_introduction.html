<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Michalis Kamburelis">
<title>Modern Object Pascal Introduction for Programmers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>.patreon-link {   display: block;   font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;   color: #777;   font-size: 14px;   line-height: 35px;   padding-bottom: 10px;   padding-left: 15px;   padding-right: 15px;   padding-top: 10px;   text-decoration: none;   text-align: left;   float: right; } a.patreon-link:hover, a.patreon-link:focus {   color: black;   background: #EEE; } </style></head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Modern Object Pascal Introduction for Programmers</h1>
<div class="details">
<span id="author" class="author">Michalis Kamburelis</span><br>
</div>
<a href="https://patreon.com/castleengine" class="patreon-link">Support the author on<br><img class="patreon-logo" src="patreon-link.png" alt="Patreon"></a> <div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_why">1. Why</a></li>
<li><a href="#_basics">2. Basics</a>
<ul class="sectlevel2">
<li><a href="#__hello_world_program">2.1. "Hello world" program</a></li>
<li><a href="#_functions_procedures_primitive_types">2.2. Functions, procedures, primitive types</a></li>
<li><a href="#_testing_if">2.3. Testing (if)</a></li>
<li><a href="#_logical_relational_and_bit_wise_operators">2.4. Logical, relational and bit-wise operators</a></li>
<li><a href="#_testing_single_expression_for_multiple_values_case">2.5. Testing single expression for multiple values (case)</a></li>
<li><a href="#_enumerated_and_ordinal_types_and_sets_and_constant_length_arrays">2.6. Enumerated and ordinal types and sets and constant-length arrays</a></li>
<li><a href="#_loops_for_while_repeat_for_in">2.7. Loops (for, while, repeat, for .. in)</a></li>
<li><a href="#_output_logging">2.8. Output, logging</a></li>
<li><a href="#_converting_to_a_string">2.9. Converting to a string</a></li>
</ul>
</li>
<li><a href="#_units">3. Units</a>
<ul class="sectlevel2">
<li><a href="#_units_using_each_other">3.1. Units using each other</a></li>
<li><a href="#_qualifying_identifiers_with_unit_name">3.2. Qualifying identifiers with unit name</a></li>
<li><a href="#_exposing_one_unit_identifiers_from_another">3.3. Exposing one unit identifiers from another</a></li>
</ul>
</li>
<li><a href="#_classes">4. Classes</a>
<ul class="sectlevel2">
<li><a href="#_basics_2">4.1. Basics</a></li>
<li><a href="#_inheritance_is_as">4.2. Inheritance, is, as</a></li>
<li><a href="#_properties">4.3. Properties</a></li>
<li><a href="#_exceptions">4.4. Exceptions</a></li>
<li><a href="#_visibility_specifiers">4.5. Visibility specifiers</a></li>
<li><a href="#_default_ancestor">4.6. Default ancestor</a></li>
<li><a href="#_self">4.7. Self</a></li>
<li><a href="#_calling_inherited_method">4.8. Calling inherited method</a></li>
<li><a href="#virtual-methods-section">4.9. Virtual methods, override and reintroduce</a></li>
</ul>
</li>
<li><a href="#_freeing_classes">5. Freeing classes</a>
<ul class="sectlevel2">
<li><a href="#_remember_to_free_the_class_instances">5.1. Remember to free the class instances</a></li>
<li><a href="#_how_to_free">5.2. How to free</a></li>
<li><a href="#_manual_and_automatic_freeing">5.3. Manual and automatic freeing</a></li>
<li><a href="#_the_virtual_destructor_called_destroy">5.4. The virtual destructor called Destroy</a></li>
<li><a href="#_free_notification">5.5. Free notification</a></li>
</ul>
</li>
<li><a href="#_run_time_library">6. Run-time library</a>
<ul class="sectlevel2">
<li><a href="#_input_output_using_streams">6.1. Input/output using streams</a></li>
<li><a href="#generic-containers-section">6.2. Containers (lists, dictionaries) using generics</a></li>
<li><a href="#_cloning_tpersistent_assign">6.3. Cloning: TPersistent.Assign</a></li>
</ul>
</li>
<li><a href="#_various_language_features">7. Various language features</a>
<ul class="sectlevel2">
<li><a href="#_local_nested_routines">7.1. Local (nested) routines</a></li>
<li><a href="#Callbacks">7.2. Callbacks (aka events, aka pointers to functions, aka procedural variables)</a></li>
<li><a href="#_generics">7.3. Generics</a></li>
<li><a href="#_overloading">7.4. Overloading</a></li>
<li><a href="#_preprocessor">7.5. Preprocessor</a></li>
<li><a href="#_records">7.6. Records</a></li>
<li><a href="#_old_style_objects">7.7. Old-style objects</a></li>
<li><a href="#_pointers">7.8. Pointers</a></li>
<li><a href="#_operator_overloading">7.9. Operator overloading</a></li>
</ul>
</li>
<li><a href="#_advanced_classes_features">8. Advanced classes features</a>
<ul class="sectlevel2">
<li><a href="#_private_and_strict_private">8.1. private and strict private</a></li>
<li><a href="#_more_stuff_inside_classes_and_nested_classes">8.2. More stuff inside classes and nested classes</a></li>
<li><a href="#_class_methods">8.3. Class methods</a></li>
<li><a href="#_class_references">8.4. Class references</a></li>
<li><a href="#_static_class_methods">8.5. Static class methods</a></li>
<li><a href="#_class_properties_and_variables">8.6. Class properties and variables</a></li>
<li><a href="#_class_helpers">8.7. Class helpers</a></li>
<li><a href="#_virtual_constructors_destructors">8.8. Virtual constructors, destructors</a></li>
<li><a href="#_an_exception_in_constructor">8.9. An exception in constructor</a></li>
</ul>
</li>
<li><a href="#_interfaces">9. Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_bare_corba_interfaces">9.1. Bare (CORBA) interfaces</a></li>
<li><a href="#_corba_and_com_types_of_interfaces">9.2. CORBA and COM types of interfaces</a></li>
<li><a href="#_interfaces_guids">9.3. Interfaces GUIDs</a></li>
<li><a href="#_reference_counted_com_interfaces">9.4. Reference-counted (COM) interfaces</a></li>
<li><a href="#_using_com_interfaces_with_reference_counting_disabled">9.5. Using COM interfaces with reference-counting disabled</a></li>
<li><a href="#_typecasting_interfaces_without_as_operator">9.6. Typecasting interfaces without "as" operator</a></li>
</ul>
</li>
<li><a href="#_about_this_document">10. About this document</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_why">1. Why</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many books and resources about Pascal out there, but too many of them talk about the old Pascal, without classes, units or generics.</p>
</div>
<div class="paragraph">
<p>So I wrote this quick introduction to what I call <strong>modern Object Pascal</strong>. Most of the programmers using it don&#8217;t really call it <em>"modern Object Pascal"</em>, we just call it  <em>"our Pascal"</em>. But when introducing the language, I feel it&#8217;s important to emphasize that it&#8217;s a modern, object-oriented language. It evolved a <strong>lot</strong> since the old (Turbo) Pascal that many people learned in schools long time ago. Feature-wise, it&#8217;s quite similar to C++ or Java or C#.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has all the modern features you expect&#8201;&#8212;&#8201;classes, units, interfaces, generics&#8230;&#8203;</p>
</li>
<li>
<p>It&#8217;s compiled to a fast, native code,</p>
</li>
<li>
<p>It&#8217;s very type safe,</p>
</li>
<li>
<p>High-level but can also be low-level if you need it to be.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also has excellent, portable and open-source compiler called the <em>Free Pascal Compiler</em>, <a href="http://freepascal.org/" class="bare">http://freepascal.org/</a> . And an accompanying IDE (editor, debugger, a library of visual components, form designer) called <em>Lazarus</em> <a href="http://lazarus.freepascal.org/" class="bare">http://lazarus.freepascal.org/</a> . Myself, I&#8217;m the creator of <em>Castle Game Engine</em>, <a href="https://castle-engine.sourceforge.io/" class="bare">https://castle-engine.sourceforge.io/</a> , which is a cool portable 3D and 2D game engine using this language to create games on many platforms (Windows, Linux, MacOSX, Android, iOS, web plugin).</p>
</div>
<div class="paragraph">
<p>This introduction is mostly directed at programmers who already have experience in other languages. We will not cover here the meanings of some universal concepts, like <em>"what is a class"</em>, we&#8217;ll only show how to do them in Pascal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basics">2. Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__hello_world_program">2.1. "Hello world" program</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span> <span class="comment">// Just use this line in all modern sources</span>

<span class="keyword">program</span> MyProgram; <span class="comment">// Save this file as myprogram.lpr</span>
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a complete program that you can <em>compile</em> and <em>run</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use the command-line FPC, just create a new file <code>myprogram.lpr</code> and execute <code>fpc myprogram.lpr</code>.</p>
</li>
<li>
<p>If you use <em>Lazarus</em>, create a new project (menu <em>Project</em> &#8594; <em>New Project</em> &#8594; <em>Simple Program</em>). Save it as <code>myprogram</code> and paste this source code as the main file. Compile using the menu item <em>Run &#8594; Compile</em>.</p>
</li>
<li>
<p>This is a command-line program, so in either case&#8201;&#8212;&#8201;just run the compiled executable from the command-line.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest of this article talks about the Object Pascal language, so don&#8217;t expect to see anything more fancy than the command-line stuff. If you want to see something cool, just create a new GUI project in <em>Lazarus</em> (<em>Project</em> &#8594; <em>New Project</em> &#8594; <em>Application</em>).
Voila&#8201;&#8212;&#8201;a working GUI application, cross-platform, with native look everywhere, using a comfortable visual component library. The <em>Lazarus</em> and <em>Free Pascal Compiler</em> come with lots of ready units for networking, GUI, database, file formats (XML, json, images&#8230;&#8203;), threading and everything else you may need. I already mentioned my cool <em>Castle Game Engine</em> earlier:)</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions_procedures_primitive_types">2.2. Functions, procedures, primitive types</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>

<span class="keyword">program</span> MyProgram;

<span class="keyword">procedure</span> MyProcedure(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">A + 10 is: </span><span class="delimiter">'</span></span>, A + <span class="integer">10</span>);
<span class="keyword">end</span>;

<span class="keyword">function</span> MyFunction(<span class="keyword">const</span> S: <span class="keyword">string</span>): <span class="keyword">string</span>;
<span class="keyword">begin</span>
  Result := S + <span class="string"><span class="delimiter">'</span><span class="content">strings are automatically managed</span><span class="delimiter">'</span></span>;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  X: Single;
<span class="keyword">begin</span>
  Writeln(MyFunction(<span class="string"><span class="delimiter">'</span><span class="content">Note: </span><span class="delimiter">'</span></span>));
  MyProcedure(<span class="integer">5</span>);

  <span class="comment">// Division using &quot;/&quot; always makes float result, use &quot;div&quot; for integer division</span>
  X := <span class="integer">15</span> / <span class="integer">5</span>;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">X is now: </span><span class="delimiter">'</span></span>, X); <span class="comment">// scientific notation</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">X is now: </span><span class="delimiter">'</span></span>, X:<span class="integer">1</span>:<span class="integer">2</span>); <span class="comment">// 2 decimal places</span>
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To return a value from a function, assign something to the magic <code>Result</code> variable. You can read and set the <code>Result</code> freely, just like a local variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">function</span> MyFunction(<span class="keyword">const</span> S: <span class="keyword">string</span>): <span class="keyword">string</span>;
<span class="keyword">begin</span>
  Result := S + <span class="string"><span class="delimiter">'</span><span class="content">something</span><span class="delimiter">'</span></span>;
  Result := Result + <span class="string"><span class="delimiter">'</span><span class="content"> something more!</span><span class="delimiter">'</span></span>;
  Result := Result + <span class="string"><span class="delimiter">'</span><span class="content"> and more!</span><span class="delimiter">'</span></span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also treat the function name (like <code>MyFunction</code> in example above) as the variable, to which you can assign. But I would discourage it in new code, as it looks "fishy" when used on the right side of the assignment expression. Just use <code>Result</code> always when you want to read or set the function result.</p>
</div>
<div class="paragraph">
<p>If you want to call the function itself recursively, you can of course do it. If you&#8217;re calling a parameter-less function recursively, be sure to specify the parenthesis (even though in Pascal you can usually omit the parentheses for a parameter-less function), this makes a recursive call to a parameter-less function different from accessing this function&#8217;s current result. Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">function</span> ReadIntegersUntilZero: <span class="keyword">string</span>;
<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  Readln(I);
  Result := IntToStr(I);
  <span class="keyword">if</span> I &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span>
    Result := Result + <span class="char"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span> + ReadIntegersUntilZero();
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can call <code>Exit</code> to end the execution of the procedure or function before it reaches the final <code>end;</code>. If you call parameter-less <code>Exit</code> in a function, it will return the last thing you set as <code>Result</code>. You can also use <code>Exit(X)</code> construct, to set the function result and exit <strong>now</strong>&#8201;&#8212;&#8201;this is just like <code>return X</code> construct in C-like languages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">function</span> AddName(<span class="keyword">const</span> ExistingNames, NewName: <span class="keyword">string</span>): <span class="keyword">string</span>;
<span class="keyword">begin</span>
  <span class="keyword">if</span> ExistingNames = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span> <span class="keyword">then</span>
    Exit(NewName);
  Result := ExistingNames + <span class="string"><span class="delimiter">'</span><span class="content">, </span><span class="delimiter">'</span></span> + NewName;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_if">2.3. Testing (if)</h3>
<div class="paragraph">
<p>Use <code>if .. then</code> or <code>if .. then .. else</code> to run some code when some condition is satisfied. Unlike in the C-like languages, in Pascal you don&#8217;t have to wrap the condition in parenthesis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  A: Integer;
  B: boolean;
<span class="keyword">begin</span>
  <span class="keyword">if</span> A &gt; <span class="integer">0</span> <span class="keyword">then</span>
    DoSomething;

  <span class="keyword">if</span> A &gt; <span class="integer">0</span> <span class="keyword">then</span>
  <span class="keyword">begin</span>
    DoSomething;
    AndDoSomethingMore;
  <span class="keyword">end</span>;

  <span class="keyword">if</span> A &gt; <span class="integer">10</span> <span class="keyword">then</span>
    DoSomething
  <span class="keyword">else</span>
    DoSomethingElse;

  <span class="comment">// equivalent to above</span>
  B := A &gt; <span class="integer">10</span>;
  <span class="keyword">if</span> B <span class="keyword">then</span>
    DoSomething
  <span class="keyword">else</span>
    DoSomethingElse;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>else</code> is paired with the last <code>if</code>. So this works as you expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> A &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span>
  <span class="keyword">if</span> B &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span>
    AIsNonzeroAndBToo
  <span class="keyword">else</span>
    AIsNonzeroButBIsZero;</code></pre>
</div>
</div>
<div class="paragraph">
<p>While the example with nested <code>if</code> above is correct, it is often better to place the nested <code>if</code> inside a <code>begin</code> &#8230;&#8203; <code>end</code> block in such cases. This makes the code more obvious to the reader, and it will remain obvious even if you mess up the indentation. The improved version of the example is below. When you add or remove some <code>else</code> clause in the code below, it&#8217;s obvious to which condition it will apply (to the <code>A</code> test or the <code>B</code> test), so it&#8217;s less error-prone.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> A &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span>
<span class="keyword">begin</span>
  <span class="keyword">if</span> B &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span>
    AIsNonzeroAndBToo
  <span class="keyword">else</span>
    AIsNonzeroButBIsZero;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logical_relational_and_bit_wise_operators">2.4. Logical, relational and bit-wise operators</h3>
<div class="paragraph">
<p>The <em>logical operators</em> are called <code>and</code>, <code>or</code>, <code>not</code>, <code>xor</code>. Their meaning is probably obvious (search for <em>"exclusive or"</em> if you&#8217;re unsure what <em>xor</em> does:). They take <em>boolean arguments</em>, and return a <em>boolean</em>. They can also act as <em>bit-wise operators</em> when both arguments are integer values, in which case they return an integer.</p>
</div>
<div class="paragraph">
<p>The <em>relational (comparison)</em> operators are <code>=</code>, <code>&lt;&gt;</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>. If you&#8217;re accustomed to C-like languages, note that in Pascal you compare two values (check are they equal) using a single equality character <code>A = B</code> (unlike in C where you use <code>A == B</code>). The special <em>assignment</em> operator in Pascal is <code>:=</code>.</p>
</div>
<div class="paragraph">
<p>The <em>logical (or bit-wise) operators have a higher precedence than relational operators</em>. So you may need to use parenthesis around some expressions.</p>
</div>
<div class="paragraph">
<p>For example this is a compilation error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  A, B: Integer;
<span class="keyword">begin</span>
  <span class="keyword">if</span> A = <span class="integer">0</span> <span class="keyword">and</span> B &lt;&gt; <span class="integer">0</span> <span class="keyword">then</span> ... <span class="comment">// INCORRECT example</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above fails to compile, because the compiler sees the bit-wise <code>and</code> inside: <code>(0 and B)</code>.</p>
</div>
<div class="paragraph">
<p>This is correct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  A, B: Integer;
<span class="keyword">begin</span>
  <span class="keyword">if</span> (A = <span class="integer">0</span>) <span class="keyword">and</span> (B &lt;&gt; <span class="integer">0</span>) <span class="keyword">then</span> ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>short-circuit evaluation</em> is used. Consider this expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> MyFunction(X) <span class="keyword">and</span> MyOtherFunction(Y) <span class="keyword">then</span>...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s guaranteed that <code>MyFunction(X)</code> will be evaluated first.</p>
</li>
<li>
<p>And if <code>MyFunction(X)</code> returns <code>false</code>, then the value of expression is known (the value of <code>false and whatever</code> is always <code>false</code>), and <code>MyOtherFunction(Y)</code> will not be executed at all.</p>
</li>
<li>
<p>Analogous rule is for <code>or</code> expression. There, if the expression is known to be <code>true</code> (because the 1st operand is <code>true</code>), the 2nd operand is not evaluated.</p>
</li>
<li>
<p>This is particularly useful when writing expressions like</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> (A &lt;&gt; <span class="keyword">nil</span>) <span class="keyword">and</span> A.IsValid <span class="keyword">then</span>...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will work OK, even when <code>A</code> is <code>nil</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_testing_single_expression_for_multiple_values_case">2.5. Testing single expression for multiple values (case)</h3>
<div class="paragraph">
<p>If a different action should be executed depending on the value of some expression, then the <code>case .. of .. end</code> statement is useful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">case</span> SomeValue <span class="keyword">of</span>
  <span class="integer">0</span>: DoSomething;
  <span class="integer">1</span>: DoSomethingElse;
  <span class="integer">2</span>: <span class="keyword">begin</span>
       IfItsTwoThenDoThis;
       AndAlsoDoThis;
     <span class="keyword">end</span>;
  <span class="integer">3</span>..<span class="integer">10</span>: DoSomethingInCaseItsInThisRange;
  <span class="integer">11</span>, <span class="integer">21</span>, <span class="integer">31</span>: AndDoSomethingForTheseSpecialValues;
  <span class="keyword">else</span> DoSomethingInCaseOfUnexpectedValue;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>else</code> clause is optional. When no condition matches, and there&#8217;s no <code>else</code>, then nothing happens.</p>
</div>
<div class="paragraph">
<p>In you come from C-like languages, and compare this with <code>switch</code> statement in these languages, you will notice that there is no automatic <em>fall-through</em>. This is a deliberate blessing in Pascal. You don&#8217;t have to remember to place <code>break</code> instructions. In every execution, <em>at most one</em> branch of the <code>case</code> is executed, that&#8217;s it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enumerated_and_ordinal_types_and_sets_and_constant_length_arrays">2.6. Enumerated and ordinal types and sets and constant-length arrays</h3>
<div class="paragraph">
<p>Enumerated type in Pascal is a very nice, opaque type. You will probably use it much more often than enums in other languages:)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TAnimalKind = (akDuck, akCat, akDog);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The convention is to prefix the enum names with a two-letter shortcut of type name, hence <code>ak</code> = shortcut for <em>"Animal Kind"</em>. This is a useful convention, since the enum names are in the unit (global) namespace. So by prefixing them with <code>ak</code> prefix, you minimize the chances of collisions with other identifiers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The collisions in names are not a show-stopper. It&#8217;s Ok for different units to define the same identifier. But it&#8217;s a good idea to try to avoid the collisions anyway, to keep code simple to understand and grep.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can avoid placing enum names in the global namespace by directive <code>{$scopedenums on}</code>. This means you will have to access them qualified by a type name, like <code>TAnimalKind.akDuck</code>. The need for <code>ak</code> prefix disappears in this situation, and you will probably just call the enums <code>Duck, Cat, Dog</code>. This is similar to C# enums.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The fact that enumerated type is <em>opaque</em> means that it cannot be just assigned to and from an integer. However, for special use, you can use <code>Ord(MyAnimalKind)</code> to forcefully convert enum to int, or typecast <code>TAnimalKind(MyInteger)</code> to forcefully convert int to enum. In the latter case, make sure to check first whether <code>MyInteger</code> is in good range (0 to <code>Ord(High(TAnimalKind))</code>).</p>
</div>
<div class="paragraph">
<p>Enumerated and ordinal types can be used as array indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TArrayOfTenStrings = <span class="keyword">array</span> [<span class="integer">0</span>..<span class="integer">9</span>] <span class="keyword">of</span> <span class="keyword">string</span>;
  TArrayOfTenStrings1Based = <span class="keyword">array</span> [<span class="integer">1</span>..<span class="integer">10</span>] <span class="keyword">of</span> <span class="keyword">string</span>;

  TMyNumber = <span class="integer">0</span>..<span class="integer">9</span>;
  TAlsoArrayOfTenStrings = <span class="keyword">array</span> [TMyNumber] <span class="keyword">of</span> <span class="keyword">string</span>;

  TAnimalKind = (akDuck, akCat, akDog);
  TAnimalNames = <span class="keyword">array</span> [TAnimalKind] <span class="keyword">of</span> <span class="keyword">string</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>They can also be used to create sets (a bit-fields internally):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TAnimalKind = (akDuck, akCat, akDog);
  TAnimals = <span class="keyword">set</span> <span class="keyword">of</span> TAnimalKind;
<span class="keyword">var</span>
  A: TAnimals;
<span class="keyword">begin</span>
  A := [];
  A := [akDuck, akCat];
  A := A + [akDog];
  A := A * [akCat, akDog];
  Include(A, akDuck);
  Exclude(A, akDuck);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loops_for_while_repeat_for_in">2.7. Loops (for, while, repeat, for .. in)</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$R+}</span> <span class="comment">// range checking on - nice for debugging</span>
<span class="keyword">var</span>
  MyArray: <span class="keyword">array</span> [<span class="integer">0</span>..<span class="integer">9</span>] <span class="keyword">of</span> Integer;
  I: Integer;
<span class="keyword">begin</span>
  <span class="comment">// initialize</span>
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> <span class="integer">9</span> <span class="keyword">do</span>
    MyArray[I] := I * I;

  <span class="comment">// show</span>
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> <span class="integer">9</span> <span class="keyword">do</span>
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square is </span><span class="delimiter">'</span></span>, MyArray[I]);

  <span class="comment">// does the same as above</span>
  <span class="keyword">for</span> I := Low(MyArray) <span class="keyword">to</span> High(MyArray) <span class="keyword">do</span>
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square is </span><span class="delimiter">'</span></span>, MyArray[I]);

  <span class="comment">// does the same as above</span>
  I := <span class="integer">0</span>;
  <span class="keyword">while</span> I &lt; <span class="integer">10</span> <span class="keyword">do</span>
  <span class="keyword">begin</span>
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square is </span><span class="delimiter">'</span></span>, MyArray[I]);
    I := I + <span class="integer">1</span>; <span class="comment">// or &quot;I += 1&quot;, or &quot;Inc(I)&quot;</span>
  <span class="keyword">end</span>;

  <span class="comment">// does the same as above</span>
  I := <span class="integer">0</span>;
  <span class="keyword">repeat</span>
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square is </span><span class="delimiter">'</span></span>, MyArray[I]);
    Inc(I);
  <span class="keyword">until</span> I = <span class="integer">10</span>;

  <span class="comment">// does the same as above</span>
  <span class="keyword">for</span> I <span class="keyword">in</span> MyArray <span class="keyword">do</span>
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square is </span><span class="delimiter">'</span></span>, I);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>About the <code>repeat</code> and <code>while</code> loops</strong>:</p>
</div>
<div class="paragraph">
<p>It may seem that the difference between the <code>while</code> and <code>repeat</code> loops is "cosmetic" (you specify a negated condition, because in <code>while .. do</code> you tell it <em>when to continue</em>, but in <code>repeat .. until</code> you tell it <em>when to stop</em>). Actually there&#8217;s another important difference: in case of <code>repeat</code>, <em>the condition is not checked at the beginning</em>. So the <code>repeat</code> loop always runs at least once.</p>
</div>
<div class="paragraph">
<p><strong>About the <code>for I := &#8230;&#8203;</code> loops</strong>:</p>
</div>
<div class="paragraph">
<p>The <code>for I := .. to .. do &#8230;&#8203;</code> construction it similar to the C-like <code>for</code> loop. However, it&#8217;s more constrained, as you cannot specify arbitrary actions/tests to control the loop iteration. This is strictly for iterating over a consecutive numbers (or other ordinal types). The only flexibility you have is that you can use <code>downto</code> instead of <code>to</code>, to make numbers go downward.</p>
</div>
<div class="paragraph">
<p>In exchange, it looks clean, and is very optimized in execution. In particular, <em>the expressions for the lower and higher bound are only calculated once</em>, before the loop starts.</p>
</div>
<div class="paragraph">
<p>Note that the value of the loop counter variable (<code>I</code> in this example) should be considered <em>undefined</em> after the loop has finished, due to possible optimizations. Accessing the value of <code>I</code> after the loop may cause a compiler warning. <em>Unless</em> you exit the loop prematurely by <code>Break</code> or <code>Exit</code>: in such case, the counter variable is guaranteed to retain the last value.</p>
</div>
<div class="paragraph">
<p><strong>About the <code>for I in &#8230;&#8203;</code> loops</strong>:</p>
</div>
<div class="paragraph">
<p>The <code>for I in .. do ..</code> is similar to <code>foreach</code> construct in many modern languages. It works intelligently on many built-in types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can iterate over all values in the array (example above).</p>
</li>
<li>
<p>It can iterate over all possible values of an enumerated type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  AK: TAnimalKind;
<span class="keyword">begin</span>
  <span class="keyword">for</span> AK <span class="keyword">in</span> TAnimalKind <span class="keyword">do</span>...</code></pre>
</div>
</div>
</li>
<li>
<p>It can iterate over all items included in the set:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  Animals: TAnimals;
  AK: TAnimalKind;
<span class="keyword">begin</span>
  Animals := [akDog, akCat];
  <span class="keyword">for</span> AK <span class="keyword">in</span> Animals <span class="keyword">do</span> ...</code></pre>
</div>
</div>
</li>
<li>
<p>And it works on custom list types, generic or not, like <code>TObjectList</code> or <code>TFPGObjectList</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, FGL;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    I, Square: Integer;
  <span class="keyword">end</span>;
  TMyClassList = specialize TFPGObjectList&lt;TMyClass&gt;;

<span class="keyword">var</span>
  List: TMyClassList;
  C: TMyClass;
  I: Integer;
<span class="keyword">begin</span>
  List := TMyClassList.Create(true); <span class="comment">// true = owns children</span>
  <span class="keyword">try</span>
    <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> <span class="integer">9</span> <span class="keyword">do</span>
    <span class="keyword">begin</span>
      C := TMyClass.Create;
      C.I := I;
      C.Square := I * I;
      List.Add(C);
    <span class="keyword">end</span>;

    <span class="keyword">for</span> C <span class="keyword">in</span> List <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square of </span><span class="delimiter">'</span></span>, C.I, <span class="string"><span class="delimiter">'</span><span class="content"> is </span><span class="delimiter">'</span></span>, C.Square);
  <span class="keyword">finally</span> FreeAndNil(List) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>We didn&#8217;t yet explain the concept of classes, so the last example may not be obvious to you yet&#8201;&#8212;&#8201;just carry on, it will make sense later:)</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_output_logging">2.8. Output, logging</h3>
<div class="paragraph">
<p>To simply output strings in Pascal, use the <code>Write</code> or <code>Writeln</code> routine. The latter automatically adds a newline at the end.</p>
</div>
<div class="paragraph">
<p>This is a "magic" routine in Pascal. It takes a variable number of arguments and they can have any type. They are all converted to strings when displaying, with a special syntax to specify padding and number precision.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>);
Writeln(<span class="string"><span class="delimiter">'</span><span class="content">You can output an integer: </span><span class="delimiter">'</span></span>, <span class="integer">3</span> * <span class="integer">4</span>);
Writeln(<span class="string"><span class="delimiter">'</span><span class="content">You can pad an integer: </span><span class="delimiter">'</span></span>, <span class="integer">666</span>:<span class="integer">10</span>);
Writeln(<span class="string"><span class="delimiter">'</span><span class="content">You can output a float: </span><span class="delimiter">'</span></span>, Pi:<span class="integer">1</span>:<span class="integer">4</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly use newline in the string, use the <code>LineEnding</code> constant (from FPC RTL). (The <em>Castle Game Engine</em> defines also a shorter <code>NL</code> constant.) Pascal strings do not interpret any special backslash sequences, so writing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">Writeln(<span class="string"><span class="delimiter">'</span><span class="content">One line.\nSecond line.</span><span class="delimiter">'</span></span>); <span class="comment">// INCORRECT example</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>doesn&#8217;t work like some of you would think. This will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">Writeln(<span class="string"><span class="delimiter">'</span><span class="content">One line.</span><span class="delimiter">'</span></span> + LineEnding + <span class="string"><span class="delimiter">'</span><span class="content">Second line.</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or just this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">Writeln(<span class="string"><span class="delimiter">'</span><span class="content">One line.</span><span class="delimiter">'</span></span>);
Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Second line.</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this will only work in <em>console</em> applications. Make sure you have <code>{$apptype CONSOLE}</code> (and <strong>not</strong> <code>{$apptype GUI}</code>) defined in your main program file. On some operating systems it actually doesn&#8217;t matter and will work always (Unix), but on some operating systems trying to write something from a GUI application is an error (Windows).</p>
</div>
<div class="paragraph">
<p><strong>In the Castle Game Engine:</strong> use <code>WritelnLog</code> or <code>WritelnWarning</code>, never <code>Writeln</code>, to print debug information. They will be always directed to some useful output. On Unix, standard output. On Windows GUI application, log file. On Android, the <em>Android logging facility</em> (visible when you use <code>adb logcat</code>). The use of <code>Writeln</code> should be limited to the cases when you write a command-line application (like a 3D model converter / generator) and you know that the <em>standard output</em> is available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_converting_to_a_string">2.9. Converting to a string</h3>
<div class="paragraph">
<p>To convert an arbitrary number of arguments to a string (instead of just directly outputting them), you have a couple of options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can convert particular types to strings using specialized functions like <code>IntToStr</code> and <code>FloatToStr</code>. Furthermore, you can concatenate strings in Pascal simply by adding them. So you can create a string like this: <code>'My int number is ' + IntToStr(MyInt) + ', and the value of Pi is ' + FloatToStr(Pi)</code>.</p>
<div class="ulist">
<ul>
<li>
<p><em>Advantage</em>: Absolutely flexible. There are many <code>XxxToStr</code> overloaded versions and friends (like <code>FormatFloat</code>), covering many types.</p>
</li>
<li>
<p><em>Another advantage</em>: Consistent with the reverse functions. To convert a string (for example, user input) back to an integer or float, you use <code>StrToInt</code>, <code>StrToFloat</code> and friends (like <code>StrToIntDef</code>).</p>
</li>
<li>
<p><em>Disadvantage</em>: A long concatenation of many <code>XxxToStr</code> calls and strings doesn&#8217;t look nice.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>Format</code> function, used like <code>Format('%d %f %s', [MyInt, MyFloat, MyString])</code>. This is like <code>sprintf</code> function in the C-like languages. It inserts the arguments into the placeholders in the pattern. The placeholders may use special syntax to influence formatting, e.g. <code>%.4f</code> results in a floating-point format with 4 digits after the decimal point.</p>
<div class="ulist">
<ul>
<li>
<p><em>Advantage</em>: The separation of <em>pattern</em> string from <em>arguments</em> looks clean. If you need to change the pattern string without touching the arguments (e.g. when translating), you can do it easily.</p>
</li>
<li>
<p><em>Another advantage</em>: No compiler magic. You can use the same syntax to pass any number of arguments of an arbitrary type in your own routines (declare parameter as an <code>array of const</code>). You can then pass these arguments downward to <code>Format</code>, or deconstruct the list of parameters and do anything you like with them.</p>
</li>
<li>
<p><em>Disadvantage</em>: Compiler does not check whether the pattern matches the arguments. Using a wrong placeholder type will result in an exception at runtime (<code>EConvertError</code> exception, not anything nasty like a segmentation fault).</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>WriteStr(TargetString, &#8230;&#8203;)</code> routine behaves much like <code>Write(&#8230;&#8203;)</code>, except that the result is saved to the <code>TargetString</code>.</p>
<div class="ulist">
<ul>
<li>
<p><em>Advantage</em>: It supports all the features of <code>Write</code>, including the special syntax for formatting like <code>Pi:1:4</code>.</p>
</li>
<li>
<p><em>Disadvantage</em>: The special syntax for formatting is a "compiler magic", implemented specifically for routines like this. This is sometimes troublesome, e.g. you cannot create your own routine <code>MyStringFormatter(&#8230;&#8203;)</code> that would also allow the special syntax like <code>Pi:1:4</code>. For this reason (and also because it wasn&#8217;t implemented for a long time in major Pascal compilers), this construction is not very popular.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_units">3. Units</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Units allow you to group common stuff (anything that can be declared), for usage by other units and programs. They are equivalent to <em>modules</em> and <em>packages</em> in other languages. They have an interface section, where you declare what is available for other units and programs, and then the implementation. Save unit <code>MyUnit</code> as <code>myunit.pas</code> (lowercase with <code>.pas</code> extension).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> MyUnit;
<span class="keyword">interface</span>

<span class="keyword">procedure</span> MyProcedure(<span class="keyword">const</span> A: Integer);
<span class="keyword">function</span> MyFunction(<span class="keyword">const</span> S: <span class="keyword">string</span>): <span class="keyword">string</span>;

<span class="keyword">implementation</span>

<span class="keyword">procedure</span> MyProcedure(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">A + 10 is: </span><span class="delimiter">'</span></span>, A + <span class="integer">10</span>);
<span class="keyword">end</span>;

<span class="keyword">function</span> MyFunction(<span class="keyword">const</span> S: <span class="keyword">string</span>): <span class="keyword">string</span>;
<span class="keyword">begin</span>
  Result := S + <span class="string"><span class="delimiter">'</span><span class="content">strings are automatically managed</span><span class="delimiter">'</span></span>;
<span class="keyword">end</span>;

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Final programs are saved as <code>myprogram.lpr</code> files (<code>lpr</code> = Lazarus program file; in Delphi you would use <code>.dpr</code>). Note that other conventions are possible here, e.g. some projects just use <code>.pas</code> for main program file, some use <code>.pp</code> for units or programs. I advice using <code>.pas</code> for units and <code>.lpr</code> for FPC/Lazarus programs.</p>
</div>
<div class="paragraph">
<p>A program can use a unit by a <code>uses</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>

<span class="keyword">program</span> MyProgram;

<span class="keyword">uses</span> MyUnit;

<span class="keyword">begin</span>
  Writeln(MyFunction(<span class="string"><span class="delimiter">'</span><span class="content">Note: </span><span class="delimiter">'</span></span>));
  MyProcedure(<span class="integer">5</span>);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_units_using_each_other">3.1. Units using each other</h3>
<div class="paragraph">
<p>One unit can also use another unit. Another unit can be used in the interface section, or only in the implementation section. The former allows to define new public stuff (procedures, types&#8230;&#8203;) on top of another unit&#8217;s stuff. The latter is more limited (if you use a unit only in the implementation section, you can use it&#8217;s identifiers only in your implementation).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> AnotherUnit;
<span class="keyword">interface</span>

<span class="keyword">uses</span> Classes;

<span class="comment">{ The &quot;TComponent&quot; type (class) is defined in the Classes unit.
  That's why we had to use the Classes unit above. }</span>
<span class="keyword">procedure</span> DoSomethingWithComponent(<span class="keyword">var</span> C: TComponent);

<span class="keyword">implementation</span>

<span class="keyword">uses</span> SysUtils;

<span class="keyword">procedure</span> DoSomethingWithComponent(<span class="keyword">var</span> C: TComponent);
<span class="keyword">begin</span>
  <span class="comment">{ The FreeAndNil procedure is defined in the SysUtils unit.
    Since we only refer to it's name in the implementation,
    it was OK to use the SysUtils unit in the &quot;implementation&quot; section. }</span>
  FreeAndNil(C);
<span class="keyword">end</span>;

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not allowed to have <em>circular unit dependencies in the interface</em>. That is, two units cannot use each other in the interface section.
The reason is that in order to "understand"
the interface section of a unit, the compiler must first "understand" all the units it uses in the interface section. Pascal language follows this rule strictly, and it allows a fast compilation and fully automatic detection on the compiler side <em>what units need to be recompiled</em>. There is no need to use complicated <code>Makefile</code> files for a simple task of compilation in Pascal, and there is no need to <em>recompile everything</em> just to make sure that all dependencies are updated correctly.</p>
</div>
<div class="paragraph">
<p>It is <em>OK to make a circular dependency between units when at least one "usage" is only in the implementation</em>. So it&#8217;s OK for unit <code>A</code> to use unit <code>B</code> in the interface, and then unit <code>B</code> to use unit <code>A</code> in the implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_qualifying_identifiers_with_unit_name">3.2. Qualifying identifiers with unit name</h3>
<div class="paragraph">
<p>Different units may define the same identifier. To keep the code simple to read and search, you should usually avoid it, but it&#8217;s not always possible.
In such cases, the last unit on the <code>uses</code> clause "wins", which means that the identifiers it introduces hide the same identifiers introduced by earlier units.</p>
</div>
<div class="paragraph">
<p>You can always explicitly define a unit of a given identifier, by using it like <code>MyUnit.MyIdentifier</code>. This is the usual solution when the identifier you want to use from <code>MyUnit</code> is hidden by another unit. Of course you can also rearrange the order of units on your uses clause, although this can affect other declarations than the one you&#8217;re trying to fix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">program</span> showcolor;

<span class="comment">// Both Graphics and GoogleMapsEngine units define TColor type.</span>
<span class="keyword">uses</span> Graphics, GoogleMapsEngine;

<span class="keyword">var</span>
  <span class="comment">{ This doesn't work like we want, as TColor ends up
    being defined by GoogleMapsEngine. }</span>
  <span class="comment">// Color: TColor;</span>
  <span class="comment">{ This works Ok. }</span>
  Color: Graphics.TColor;
<span class="keyword">begin</span>
  Color := clYellow;
  Writeln(Red(Color), <span class="char"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>, Green(Color), <span class="char"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>, Blue(Color));
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of units, remember that they have two <code>uses</code> clauses: one in the interface, and another one in the implementation. The rule <em>later units hide the stuff from earlier units</em> is applied here consistently, which means that <em>units used in the implementation section</em> can hide identifiers from units <em>used in the interface section</em>. However, remember that when reading the <code>interface</code> section, only the units used in the interface matter. This may create a confusing situation, where two seemingly-equal declarations are considered different by the compiler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> UnitUsingColors;

<span class="comment">// INCORRECT example</span>

<span class="keyword">interface</span>

<span class="keyword">uses</span> Graphics;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: TColor);

<span class="keyword">implementation</span>

<span class="keyword">uses</span> GoogleMapsEngine;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: TColor);
<span class="keyword">begin</span>
  <span class="comment">// Writeln(ColorToString(Color));</span>
<span class="keyword">end</span>;

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The unit <code>Graphics</code> (from Lazarus LCL) defines the <code>TColor</code> type. But the compiler will fail to compile the above unit, claiming that you don&#8217;t implement a procedure <code>ShowColor</code> that matches the interface declaration. The problem is that unit <code>GoogleMapsEngine</code> also defines a <code>TColor</code> type. And it is used only in the <code>implementation</code> section, therefore it <em>shadows</em> the <code>TColor</code> definition only in the implementation. The equivalent version of the above unit, where the error is obvious, looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> UnitUsingColors;

<span class="comment">// INCORRECT example.</span>
<span class="comment">// This is what the compiler &quot;sees&quot; when trying to compile previous example</span>

<span class="keyword">interface</span>

<span class="keyword">uses</span> Graphics;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: Graphics.TColor);

<span class="keyword">implementation</span>

<span class="keyword">uses</span> GoogleMapsEngine;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: GoogleMapsEngine.TColor);
<span class="keyword">begin</span>
  <span class="comment">// Writeln(ColorToString(Color));</span>
<span class="keyword">end</span>;

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution is trivial in this case, just change the implementation to explicitly use <code>TColor</code> from <code>Graphics</code> unit. You could fix it also by moving the <code>GoogleMapsEngine</code> usage, to the interface section and earlier than <code>Graphics</code>, although this could result in other consequences in real-world cases, when <code>UnitUsingColors</code> would define more things.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> UnitUsingColors;

<span class="keyword">interface</span>

<span class="keyword">uses</span> Graphics;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: TColor);

<span class="keyword">implementation</span>

<span class="keyword">uses</span> GoogleMapsEngine;

<span class="keyword">procedure</span> ShowColor(<span class="keyword">const</span> Color: Graphics.TColor);
<span class="keyword">begin</span>
  <span class="comment">// Writeln(ColorToString(Color));</span>
<span class="keyword">end</span>;

<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exposing_one_unit_identifiers_from_another">3.3. Exposing one unit identifiers from another</h3>
<div class="paragraph">
<p>Sometimes you want to take an identifier from one unit, and <em>expose</em> it in a new unit. The end result should be that using the new unit will make the identifier available in the namespace.</p>
</div>
<div class="paragraph">
<p>Sometimes this is necessary to preserve backward compatibility with previous unit versions. Sometimes it&#8217;s nice to "hide" an internal unit this way.</p>
</div>
<div class="paragraph">
<p>This can be done by redefining the identifier in your new unit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> MyUnit;

<span class="keyword">interface</span>

<span class="keyword">uses</span> Graphics;

<span class="keyword">type</span>
  <span class="comment">{ Expose TColor from Graphics unit as TMyColor. }</span>
  TMyColor = TColor;

  <span class="comment">{ Alternatively, expose it under the same name.
    Qualify with unit name in this case, otherwise
    we would refer to ourselves with &quot;TColor = TColor&quot; definition. }</span>
  TColor = Graphics.TColor;

<span class="keyword">const</span>
  <span class="comment">{ This works with constants too. }</span>
  clYellow = Graphics.clYellow;
  clBlue = Graphics.clBlue;

<span class="keyword">implementation</span>

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this trick cannot be done as easily with global procedures, functions and variables. With procedures and functions, you could expose a constant pointer to a procedure in another unit (see <a href="#Callbacks">Callbacks (aka events, aka pointers to functions, aka procedural variables)</a>), but that looks quite dirty.</p>
</div>
<div class="paragraph">
<p>The usual solution is then to create a trivial "wrapper" functions that underneath simply call the functions from the internal unit, passing the parameters and return values around.</p>
</div>
<div class="paragraph">
<p>To make this work with global variables, one can use global (unit-level) properties, see <a href="#_properties">Properties</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_classes">4. Classes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_basics_2">4.1. Basics</h3>
<div class="paragraph">
<p>We have classes. At the basic level, a class is just a container for</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>fields</em> (which is fancy name for <em>"a variable inside a class"</em>),</p>
</li>
<li>
<p><em>methods</em> (which is fancy name for <em>"a procedure or function inside a class"</em>),</p>
</li>
<li>
<p>and <em>properties</em> (which is a fancy syntax for something that looks like a field, but is in fact a pair of methods to <em>get</em> and <em>set</em> something; more in <a href="#_properties">Properties</a>).</p>
</li>
<li>
<p>Actually, there are more possibilities, described in <a href="#_more_stuff_inside_classes_and_nested_classes">More stuff inside classes and nested classes</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    MyInt: Integer;
    <span class="keyword">procedure</span> MyMethod;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.MyMethod;
<span class="keyword">begin</span>
  Writeln(MyInt + <span class="integer">10</span>);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inheritance_is_as">4.2. Inheritance, is, as</h3>
<div class="paragraph">
<p>We have inheritance and virtual methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">program</span> MyProgram;

<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    MyInt: Integer;
    <span class="keyword">procedure</span> MyVirtualMethod; <span class="directive">virtual</span>;
  <span class="keyword">end</span>;

  TMyClassDescendant = <span class="keyword">class</span>(TMyClass)
    <span class="keyword">procedure</span> MyVirtualMethod; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.MyVirtualMethod;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass shows MyInt + 10: </span><span class="delimiter">'</span></span>, MyInt + <span class="integer">10</span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClassDescendant.MyVirtualMethod;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClassDescendant shows MyInt + 20: </span><span class="delimiter">'</span></span>, MyInt + <span class="integer">20</span>);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C: TMyClass;
<span class="keyword">begin</span>
  C := TMyClass.Create;
  <span class="keyword">try</span>
    C.MyVirtualMethod;
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;

  C := TMyClassDescendant.Create;
  <span class="keyword">try</span>
    C.MyVirtualMethod;
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default methods are not virtual, declare them with <code>virtual</code> to make them. Overrides must be marked with <code>override</code>, otherwise you will get a warning. To hide a method without overriding (usually you don&#8217;t want to do this, unless you now what you&#8217;re doing) use <code>reintroduce</code>.</p>
</div>
<div class="paragraph">
<p>To test the class of an instance at runtime, use the <code>is</code> operator. To typecast the instance to a specific class, use the <code>as</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">program</span> is_as;

<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    <span class="keyword">procedure</span> MyMethod;
  <span class="keyword">end</span>;

  TMyClassDescendant = <span class="keyword">class</span>(TMyClass)
    <span class="keyword">procedure</span> MyMethodInDescendant;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.MyMethod;
<span class="keyword">begin</span> Writeln(<span class="string"><span class="delimiter">'</span><span class="content">MyMethod</span><span class="delimiter">'</span></span>) <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClassDescendant.MyMethodInDescendant;
<span class="keyword">begin</span> Writeln(<span class="string"><span class="delimiter">'</span><span class="content">MyMethodInDescendant</span><span class="delimiter">'</span></span>) <span class="keyword">end</span>;

<span class="keyword">var</span>
  Descendant: TMyClassDescendant;
  C: TMyClass;
<span class="keyword">begin</span>
  Descendant := TMyClassDescendant.Create;
  <span class="keyword">try</span>
    Descendant.MyMethod;
    Descendant.MyMethodInDescendant;

    <span class="comment">{ Descendant has all functionality expected of
      the TMyClass, so this assignment is OK }</span>
    C := Descendant;
    C.MyMethod;

    <span class="comment">{ this cannot work, since TMyClass doesn't define this method }</span>
    <span class="comment">//C.MyMethodInDescendant;</span>
    <span class="keyword">if</span> C <span class="keyword">is</span> TMyClassDescendant <span class="keyword">then</span>
      (C <span class="keyword">as</span> TMyClassDescendant).MyMethodInDescendant;

  <span class="keyword">finally</span> FreeAndNil(Descendant) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of casting using <code>X as TMyClass</code>, you can also use the <em>unchecked</em> typecast <code>TMyClass(X)</code>. This is faster, but results in an undefined behavior if the <code>X</code> is not, in fact, a <code>TMyClass</code> descendant. So don&#8217;t use the <code>TMyClass(X)</code> typecast, or use it only in a code where it&#8217;s blindingly obvious that it&#8217;s correct, for example right after testing with <code>is</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> A <span class="keyword">is</span> TMyClass <span class="keyword">then</span>
  (A <span class="keyword">as</span> TMyClass).CallSomeMethodOfMyClass;
<span class="comment">// below is marginally faster</span>
<span class="keyword">if</span> A <span class="keyword">is</span> TMyClass <span class="keyword">then</span>
  TMyClass(A).CallSomeMethodOfMyClass;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties">4.3. Properties</h3>
<div class="paragraph">
<p>Properties are a very nice <em>"syntax sugar"</em> to</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make something that looks like a field (can be read and set) but underneath is realized by calling a <em>getter</em> and <em>setter</em> methods. The typical usage is to perform some side-effect (e.g. redraw the screen) each time some value changes.</p>
</li>
<li>
<p>Make something that looks like a field, but is read-only. In effect, it&#8217;s like a constant or a parameter-less function.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TWebPage = <span class="keyword">class</span>
  <span class="directive">private</span>
    FURL: <span class="keyword">string</span>;
    FColor: TColor;
    <span class="keyword">function</span> SetColor(<span class="keyword">const</span> Value: TColor);
  <span class="directive">public</span>
    <span class="comment">{ No way to set it directly.
      Call the Load method, like Load('http://www.freepascal.org/'),
      to load a page and set this property. }</span>
    <span class="keyword">property</span> URL: <span class="keyword">string</span> <span class="directive">read</span> FURL;
    <span class="keyword">procedure</span> Load(<span class="keyword">const</span> AnURL: <span class="keyword">string</span>);
    <span class="keyword">property</span> Color: TColor <span class="directive">read</span> FColor <span class="directive">write</span> SetColor;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TWebPage.Load(<span class="keyword">const</span> AnURL: <span class="keyword">string</span>);
<span class="keyword">begin</span>
  FURL := AnURL;
  NetworkingComponent.LoadWebPage(AnURL);
<span class="keyword">end</span>;

<span class="keyword">function</span> TWebPage.SetColor(<span class="keyword">const</span> Value: TColor);
<span class="keyword">begin</span>
  <span class="keyword">if</span> FColor &lt;&gt; Value <span class="keyword">then</span>
  <span class="keyword">begin</span>
    FColor := Value;
    <span class="comment">// for example, cause some update each time value changes</span>
    Repaint;
    <span class="comment">// as another example, make sure that some underlying instance,</span>
    <span class="comment">// like a &quot;RenderingComponent&quot; (whatever that is),</span>
    <span class="comment">// has a synchronized value of Color.</span>
    RenderingComponent.Color := Value;
  <span class="keyword">end</span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that instead of specifying a method, you can also specify a field (typically a private field) to directly get or set. In the example above, the <code>Color</code> property uses a <em>setter</em> method <code>SetColor</code>. But for getting the value, the <code>Color</code> property refers directly to the private field <code>FColor</code>. Directly referring to a field is faster than implementing trivial getter or setter methods (faster for you, and faster at execution).</p>
</div>
<div class="paragraph">
<p>When declaring a property you specify:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Whether it can be read, and how (by directly reading a field, or by using a "getter" method).</p>
</li>
<li>
<p>And, in a similar manner,  whether it can be set, and how (by directly writing to a designated field, or by calling a "setter" method).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The compiler checks that the types and parameters of indicated fields and methods match with the property type. For example, to read an <code>Integer</code> property you have to either provide an <code>Integer</code> field, or a parameter-less method that returns an <code>Integer</code>.</p>
</div>
<div class="paragraph">
<p>Technically, for the compiler, the "getter" and "setter" methods are just normal methods and they can do absolutely anything (including side-effects or randomization). But it&#8217;s a good convention to design properties to behave more-or-less like fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>getter</em> function should have no visible side-effects (e.g. it should not read some input from file / keyboard). It should be deterministic (no randomization, not even pseudo-randomization :). Reading a property many times should be valid, and return the same value, if nothing changed in-between.</p>
<div class="paragraph">
<p>Note that it&#8217;s OK for <em>getter</em> to have some <em>invisible</em> side-effect, for example to cache a value of some calculation (known to produce the same results for given instance), to return it faster next time. This is in fact one of the cool possibilities of a "getter" function.</p>
</div>
</li>
<li>
<p>The <em>setter</em> function should always set the requested value, such that calling the <em>getter</em> yields it back. Do not reject invalid values silently in the "setter" (raise an exception if you must). Do not convert or scale the requested value. The idea is that after <code>MyClass.MyProperty := 123;</code> the programmer can expect that <code>MyClass.MyProperty = 123</code>.</p>
</li>
<li>
<p>The <em>read-only properties</em> are often used to make some field read-only from the outside. Again, the good convention is to make it behave like a constant, at least constant for this object instance with this state. The value of the property should not change unexpectedly. <em>Make it a function, not a property, if using it has a side effect or returns something random.</em></p>
</li>
<li>
<p>The <em>"backing" field of a property is almost always private</em>, since the idea of a property is to encapsulate all outside access to it.</p>
</li>
<li>
<p>It&#8217;s technically possible to make <em>set-only properties</em>, but I have not yet seen a good example of such thing:)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Properties can also be defined outside of class, at a unit level. They serve an analogous purpose then: look like a global variable, but are backed by a <em>getter</em> and <em>setter</em> routines.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">4.4. Exceptions</h3>
<div class="paragraph">
<p>We have exceptions. They can be caught with <code>try &#8230;&#8203; except &#8230;&#8203; end</code> clauses, and we have finally sections like <code>try &#8230;&#8203; finally &#8230;&#8203; end</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>

<span class="keyword">program</span> MyProgram;

<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    <span class="keyword">procedure</span> MyMethod;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.MyMethod;
<span class="keyword">begin</span>
  <span class="keyword">if</span> Random &gt; <span class="float">0.5</span> <span class="keyword">then</span>
    <span class="keyword">raise</span> Exception.Create(<span class="string"><span class="delimiter">'</span><span class="content">Raising an exception!</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C: TMyClass;
<span class="keyword">begin</span>
  C := TMyClass.Create;
  <span class="keyword">try</span>
    C.MyMethod;
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>finally</code> clause is executed even if you exit the block using the <code>Exit</code> (from function / procedure / method) or <code>Break</code> or <code>Continue</code> (from loop body).</p>
</div>
</div>
<div class="sect2">
<h3 id="_visibility_specifiers">4.5. Visibility specifiers</h3>
<div class="paragraph">
<p>As in most object-oriented languages, we have visibility specifiers to hide fields / methods / properties.</p>
</div>
<div class="paragraph">
<p>The basic visibility levels are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>public</code></dt>
<dd>
<p>everyone can access it, including the code in other units.</p>
</dd>
<dt class="hdlist1"><code>private</code></dt>
<dd>
<p>only accessible in this class.</p>
</dd>
<dt class="hdlist1"><code>protected</code></dt>
<dd>
<p>only accessible in this class and descendants.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The explanation of <code>private</code> and <code>protected</code> visibility above is not precisely true. The code <em>in the same unit</em> can overcome their limits, and access the <code>private</code> and <code>protected</code> stuff freely. Sometimes this is a nice feature, allows you to implement tightly-connected classes. Use <code>strict private</code> or <code>strict protected</code> to secure your classes more tightly. See the <a href="#_private_and_strict_private">private and strict private</a>.</p>
</div>
<div class="paragraph">
<p>By default, if you don&#8217;t specify the visibility, then the visibility of declared stuff is <code>public</code>. The exception is for classes compiled with <code>{$M+}</code>, or descendants of classes compiled with <code>{$M+}</code>, which includes all descendants of <code>TPersistent</code>, which also includes all descendants of <code>TComponent</code> (since <code>TComponent</code> descends from <code>TPersistent</code>). For them, the default visibility specifier is <code>published</code>, which is like <code>public</code>, but in addition the streaming system knows to handle this.</p>
</div>
<div class="paragraph">
<p>Not every field and property type is allowed in the <code>published</code> section (not every type can be streamed, and only classes can be streamed from simple fields). Just use <code>public</code> if you don&#8217;t care about streaming but want something available to all users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_ancestor">4.6. Default ancestor</h3>
<div class="paragraph">
<p>If you don&#8217;t declare the ancestor type, every <code>class</code> inherits from <code>TObject</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_self">4.7. Self</h3>
<div class="paragraph">
<p>The special keyword <code>Self</code> can be used within the class implementation to explicitly refer to your own instance. It is equivalent to <code>this</code> from C++, Java and similar languages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_inherited_method">4.8. Calling inherited method</h3>
<div class="paragraph">
<p>Within a method implementation, if you call another method, then by default you call the method of your own class. In the example code below, <code>TMyClass2.MyOtherMethod</code> calls <code>MyMethod</code>, which ends up calling <code>TMyClass2.MyMethod</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass1 = <span class="keyword">class</span>
    <span class="keyword">procedure</span> MyMethod;
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TMyClass1)
    <span class="keyword">procedure</span> MyMethod;
    <span class="keyword">procedure</span> MyOtherMethod;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass1.MyMethod;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.MyMethod</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.MyMethod;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.MyMethod</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.MyOtherMethod;
<span class="keyword">begin</span>
  MyMethod; <span class="comment">// this calls TMyClass2.MyMethod</span>
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C: TMyClass2;
<span class="keyword">begin</span>
  C := TMyClass2.Create;
  <span class="keyword">try</span>
    C.MyOtherMethod;
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the method is not defined in a given class, then it calls the method of an ancestor class. In effect, when you call <code>MyMethod</code> on an instance of <code>TMyClass2</code>, then</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The compiler looks for <code>TMyClass2.MyMethod</code>.</p>
</li>
<li>
<p>If not found, it looks for <code>TMyClass1.MyMethod</code>.</p>
</li>
<li>
<p>If not found, it looks for <code>TObject.MyMethod</code>.</p>
</li>
<li>
<p>if not found, then the compilation fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can test it by commenting out the <code>TMyClass2.MyMethod</code> definition in the example above. In effect, <code>TMyClass1.MyMethod</code> will be called by <code>TMyClass2.MyOtherMethod</code>.</p>
</div>
<div class="paragraph">
<p>Sometimes, you don&#8217;t want to call the method of your own class. You want to call the method of an ancestor (or ancestor&#8217;s ancestor, and so on). To do this, add the keyword <code>inherited</code> before the call to <code>MyMethod</code>, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">inherited</span> MyMethod;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way you <em>force</em> the compiler to start searching from an ancestor class. In our example, it means that compiler is searching for <code>MyMethod</code> inside <code>TMyClass1.MyMethod</code>, then <code>TObject.MyMethod</code>, and then gives up. It does not even consider using the implementation of <code>TMyClass2.MyMethod</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Go ahead, change the implementation of <code>TMyClass2.MyOtherMethod</code> above to use <code>inherited MyMethod</code>, and see the difference in the output.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>inherited</code> call is often used to call the ancestor method of the same name. This way the descendants can enhance the ancestors (keeping the ancestor functionality, instead of replacing the ancestor functionality). Like in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass1 = <span class="keyword">class</span>
    <span class="keyword">constructor</span> Create;
    <span class="keyword">procedure</span> MyMethod(<span class="keyword">const</span> A: Integer);
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TMyClass1)
    <span class="keyword">constructor</span> Create;
    <span class="keyword">procedure</span> MyMethod(<span class="keyword">const</span> A: Integer);
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TMyClass1.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span> Create; <span class="comment">// this calls TObject.Create</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.Create</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass1.MyMethod(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.MyMethod </span><span class="delimiter">'</span></span>, A);
<span class="keyword">end</span>;

<span class="keyword">constructor</span> TMyClass2.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span> Create; <span class="comment">// this calls TMyClass1.Create</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.Create</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.MyMethod(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  <span class="keyword">inherited</span> MyMethod(A); <span class="comment">// this calls TMyClass1.MyMethod</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.MyMethod </span><span class="delimiter">'</span></span>, A);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C: TMyClass2;
<span class="keyword">begin</span>
  C := TMyClass2.Create;
  <span class="keyword">try</span>
    C.MyMethod(<span class="integer">123</span>);
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since using <code>inherited</code> to call a method with the same name, with the same arguments, is a very often case, there is a special shortcut for it: you can just write <code>inherited;</code> (<code>inherited</code> keyword followed immediately by a semicolon, instead of a method name). This means "<em>call an inherited method with the same name, passing it the same arguments as the current method</em>".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In the above example, all the <code>inherited &#8230;&#8203;;</code> calls could be replaced by a simple <code>inherited;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note 1: The <code>inherited;</code> is really just a shortcut for calling the ancestor&#8217;s method with the <em>same variables passed in</em>. If you have modified your own parameter (which is possible, if the parameter is not <code>const</code>), then the ancestor&#8217;s method can receive different input values from your descendant. Consider this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">procedure</span> TMyClass2.MyMethod(A: Integer);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.MyMethod beginning </span><span class="delimiter">'</span></span>, A);
  A := <span class="integer">456</span>;
  <span class="comment">{ This calls TMyClass1.MyMethod with A = 456,
    regardless of the A value passed to this method (TMyClass2.MyMethod). }</span>
  <span class="keyword">inherited</span>;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.MyMethod ending </span><span class="delimiter">'</span></span>, A);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note 2: You usually want to make the <code>MyMethod</code> <em>virtual</em> when many classes (along the "<em>inheritance chain</em>") define it. More about the virtual methods in the section below. But the <code>inherited</code> keyword works regardless if the method is virtual or not. The <code>inherited</code> always means that the compiler starts searching for the method in an ancestor, and it makes sense for both <em>virtual</em> and <em>not virtual</em> methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtual-methods-section">4.9. Virtual methods, override and reintroduce</h3>
<div class="paragraph">
<p>By default, the methods are <em>not virtual</em>. This is similar to C++, and unlike Java.</p>
</div>
<div class="paragraph">
<p>When a method is <em>not virtual</em>, the compiler determines which method to call based on the currently <em>declared</em> class type, not based on the <em>actually created</em> class type. The difference seems subtle, but it&#8217;s important when your variable is declared to have a class like <code>TFruit</code>, but it may be in fact a descendant class like <code>TApple</code>.</p>
</div>
<div class="paragraph">
<p>The idea of the object-oriented programming is that <em>the descendant class is always as good as the ancestor</em>, so the compiler allows to use a descendant class always when the ancestor is expected. When your method is not virtual, this can have undesired consequences. Consider the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TFruit = <span class="keyword">class</span>
    <span class="keyword">procedure</span> Eat;
  <span class="keyword">end</span>;

  TApple = <span class="keyword">class</span>(TFruit)
    <span class="keyword">procedure</span> Eat;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TFruit.Eat;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Eating a fruit</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TApple.Eat;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Eating an apple</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> DoSomethingWithAFruit(<span class="keyword">const</span> Fruit: TFruit);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">We have a fruit with class </span><span class="delimiter">'</span></span>, Fruit.ClassName);
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">We eat it:</span><span class="delimiter">'</span></span>);
  Fruit.Eat;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  Apple: TApple; <span class="comment">// Note: you could as well declare &quot;Apple: TFruit&quot; here</span>
<span class="keyword">begin</span>
  Apple := TApple.Create;
  <span class="keyword">try</span>
    DoSomethingWithAFruit(Apple);
  <span class="keyword">finally</span> FreeAndNil(Apple) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre>We have a fruit with class TApple
We eat it:
Eating a fruit</pre>
</div>
</div>
<div class="paragraph">
<p>In effect, the call <code>Fruit.Eat</code> called the <code>TFruit.Eat</code> implementation, and nothing calls the <code>TApple.Eat</code> implementation.</p>
</div>
<div class="paragraph">
<p>If you think about how the compiler works, this is natural: when you wrote the <code>Fruit.Eat</code>, the <code>Fruit</code> variable was declared to hold a class <code>TFruit</code>. So the compiler was searching for the method called <code>Eat</code> within the <code>TFruit</code> class. If the <code>TFruit</code> class would not contain such method, the compiler would search within an ancestor (<code>TObject</code> in this case). But the compiler <em>cannot search within descendants (like <code>TApple</code>)</em>, as it doesn&#8217;t know whether the <em>actual class</em> of <code>Fruit</code> is <code>TApple</code>, <code>TFruit</code>, or some other <code>TFruit</code> descendant (like a <code>TOrange</code>, not shown in the example above).</p>
</div>
<div class="paragraph">
<p>In other words, the <em>method to be called</em> is determined <em>at compile-time</em>.</p>
</div>
<div class="paragraph">
<p>Using the <em>virtual methods</em> changes this behavior. <strong>If the <code>Eat</code> method would be virtual</strong> (an example of it is shown below), then the actual implementation to be called is determined <em>at runtime</em>. If the <code>Fruit</code> variable will hold an instance of the class <code>TApple</code> (even if it&#8217;s declared as <code>TFruit</code>), then the <code>Eat</code> method will be searched within the <code>TApple</code> class first.</p>
</div>
<div class="paragraph">
<p>In Object Pascal, to define a method as <em>virtual</em>, you need to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mark it&#8217;s first definition (in the top-most ancestor) with the <code>virtual</code> keyword.</p>
</li>
<li>
<p>Mark all the other definitions (in the descendants) with the <code>override</code> keyword. All the overridden versions must have exactly the same parameters (and return the same types, in case of functions).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TFruit = <span class="keyword">class</span>
    <span class="keyword">procedure</span> Eat; <span class="directive">virtual</span>;
  <span class="keyword">end</span>;

  TApple = <span class="keyword">class</span>(TFruit)
    <span class="keyword">procedure</span> Eat; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TFruit.Eat;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Eating a fruit</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TApple.Eat;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Eating an apple</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> DoSomethingWithAFruit(<span class="keyword">const</span> Fruit: TFruit);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">We have a fruit with class </span><span class="delimiter">'</span></span>, Fruit.ClassName);
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">We eat it:</span><span class="delimiter">'</span></span>);
  Fruit.Eat;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  Apple: TApple; <span class="comment">// Note: you could as well declare &quot;Apple: TFruit&quot; here</span>
<span class="keyword">begin</span>
  Apple := TApple.Create;
  <span class="keyword">try</span>
    DoSomethingWithAFruit(Apple);
  <span class="keyword">finally</span> FreeAndNil(Apple) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will print</p>
</div>
<div class="listingblock">
<div class="content">
<pre>We have a fruit with class TApple
We eat it:
Eating an apple</pre>
</div>
</div>
<div class="paragraph">
<p>Internally, virtual methods work by having so-called <em>virtual method table</em> associated with each class. This table is a list of pointers to the implementations of virtual methods for this class. When calling the <code>Eat</code> method, the compiler looks into a virtual method table associated with the actual class of <code>Fruit</code>, and uses a pointer to the <code>Eat</code> implementation stored there.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t use the <code>override</code> keyword, the compiler will warn you that you&#8217;re <em>hiding</em> (obscuring) the virtual method of an ancestor with a non-virtual definition. If you&#8217;re sure that this is what you want, you can add a <code>reintroduce</code> keyword. But in most cases, you will rather want to keep the method virtual, and add the <code>override</code> keyword, thus making sure that it&#8217;s always invoked correctly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_freeing_classes">5. Freeing classes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_remember_to_free_the_class_instances">5.1. Remember to free the class instances</h3>
<div class="paragraph">
<p>The class instances have to be manually freed, otherwise you get memory leaks. I advice using FPC <code>-gl -gh</code> options to detect memory leaks (see <a href="https://castle-engine.sourceforge.io/manual_optimization.php#section_memory" class="bare">https://castle-engine.sourceforge.io/manual_optimization.php#section_memory</a> ).</p>
</div>
<div class="paragraph">
<p>Note that this doesn&#8217;t concern raised exceptions. Although you do create a class when raising an exception (and it&#8217;s a perfectly normal class, and you can create your own classes for this purpose too). But this class instance is freed automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_free">5.2. How to free</h3>
<div class="paragraph">
<p>To free the class instance, it&#8217;s best to call <code>FreeAndNil(A)</code> on your class instance. It checks whether <code>A</code> is <code>nil</code>, if not&#8201;&#8212;&#8201;calls it&#8217;s destructor, and sets <code>A</code> to <code>nil</code>. So calling it many times in a row is not an error.</p>
</div>
<div class="paragraph">
<p>It is more-or-less a shortcut for</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> A &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
<span class="keyword">begin</span>
  A.Destroy;
  A := <span class="keyword">nil</span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actually, that&#8217;s an oversimplification, as <code>FreeAndNil</code> does a useful trick and sets the variable <code>A</code> to <code>nil</code> <strong>before</strong> calling the destructor on a suitable reference. This helps to prevent a certain class of bugs&#8201;&#8212;&#8201;the idea is that the "outside" code should never access a half-destructed instance of the class.</p>
</div>
<div class="paragraph">
<p>Often you will also see people using the <code>A.Free</code> method, which is like doing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> A &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
  A.Destroy;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This frees the <code>A</code>, unless it&#8217;s <code>nil</code>.</p>
</div>
<div class="paragraph">
<p>Note that in normal circumstances, you should never call a method on an instance which may be <code>nil</code>. So the call <code>A.Free</code> may look suspicious at the first sight, if <code>A</code> can be <code>nil</code>. However, the <code>Free</code> method is an exception to this rule. It does something dirty in the implementation&#8201;&#8212;&#8201;namely, checks whether <code>Self &lt;&gt; nil</code>. This dirty trick works only in non-virtual methods (that don&#8217;t call any virtual methods and don&#8217;t access any fields).</p>
</div>
<div class="paragraph">
<p>I advice using <code>FreeAndNil(A)</code> always, without exceptions, and never to call directly the <code>Free</code> method or <code>Destroy</code> destructor. The <em>Castle Game Engine</em> does it like that. It helps to keep a nice assertion that <em>all references are either nil, or point to valid instances</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manual_and_automatic_freeing">5.3. Manual and automatic freeing</h3>
<div class="paragraph">
<p>In many situations, the need to free the instance is not much problem. You just write a destructor, that matches a constructor, and deallocates everything that was allocated in the constructor (or, more completely, in the whole lifetime of the class). Be careful to only free each thing <strong>once</strong>. Usually it&#8217;s a good idea to set the freed reference to <code>nil</code>, usually it&#8217;s most comfortable to do it by calling the <code>FreeAndNil(A)</code>.</p>
</div>
<div class="paragraph">
<p>So, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TGun = <span class="keyword">class</span>
  <span class="keyword">end</span>;

  TPlayer = <span class="keyword">class</span>
    Gun1, Gun2: TGun;
    <span class="keyword">constructor</span> Create;
    <span class="keyword">destructor</span> Destroy; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TPlayer.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  Gun1 := TGun.Create;
  Gun2 := TGun.Create;
<span class="keyword">end</span>;

<span class="keyword">destructor</span> TPlayer.Destroy;
<span class="keyword">begin</span>
  FreeAndNil(Gun1);
  FreeAndNil(Gun2);
  <span class="keyword">inherited</span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid the need to explicitly free the instance, one can also use the <code>TComponent</code> feature of <em>"ownership"</em>. An object that is <em>owned</em> will be automatically freed by the <em>owner</em>. The mechanism is smart and it will never free an already freed instance (so things will also work correctly if you manually free the owned object earlier). We can change the previous example to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">uses</span> SysUtils, Classes;

<span class="keyword">type</span>
  TGun = <span class="keyword">class</span>(TComponent)
  <span class="keyword">end</span>;

  TPlayer = <span class="keyword">class</span>(TComponent)
    Gun1, Gun2: TGun;
    <span class="keyword">constructor</span> Create(AOwner: TComponent); <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TPlayer.Create(AOwner: TComponent);
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  Gun1 := TGun.Create(Self);
  Gun2 := TGun.Create(Self);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we need to override a virtual <code>TComponent</code> constructor here. So we cannot change the constructor parameters. (Actually, you can&#8201;&#8212;&#8201;declare a new constructor with <code>reintroduce</code>. But be careful, as some functionality, e.g. streaming, will still use the virtual constructor, so make sure it works right in either case.)</p>
</div>
<div class="paragraph">
<p>Another mechanism for automatic freeing is the <code>OwnsObjects</code> functionality (by default already <code>true</code>!) of list-classes like <code>TFPGObjectList</code> or <code>TObjectList</code>. So we can also write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">uses</span> SysUtils, Classes, FGL;

<span class="keyword">type</span>
  TGun = <span class="keyword">class</span>
  <span class="keyword">end</span>;

  TGunList = specialize TFPGObjectList&lt;TGun&gt;;

  TPlayer = <span class="keyword">class</span>
    Guns: TGunList;
    Gun1, Gun2: TGun;
    <span class="keyword">constructor</span> Create;
    <span class="keyword">destructor</span> Destroy; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TPlayer.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  <span class="comment">// Actually, the parameter true (OwnsObjects) is already the default</span>
  Guns := TGunList.Create(true);
  Gun1 := TGun.Create(Self);
  Guns.Add(Gun1);
  Gun2 := TGun.Create(Self);
  Guns.Add(Gun2);
<span class="keyword">end</span>;

<span class="keyword">destructor</span> TPlayer.Destroy;
<span class="keyword">begin</span>
  <span class="comment">{ We have to take care to free the list.
    It will automatically free it's contents. }</span>
  FreeAndNil(Guns);

  <span class="comment">{ No need to free the Gun1, Gun2 anymore. It's a nice habit to set to &quot;nil&quot;
    their references now, as we know they are freed. In this simple class,
    with so simple destructor, it's obvious that they cannot be accessed
    anymore -- but doing this pays off in case of larger and more complicated
    destructors.

    Alternatively, we could avoid declaring Gun1 and Gun2,
    and instead use Guns[0] and Guns[1] in own code.
    Or create a method like Gun1 that returns Guns[0]. }</span>
  Gun1 := <span class="keyword">nil</span>;
  Gun2 := <span class="keyword">nil</span>;
  <span class="keyword">inherited</span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beware that the list classes "ownership" mechanism is simple, and you will get an error if you free the instance using some other means, while it&#8217;s also contained within a list. Use the <code>Extract</code> method to remove something from a list without freeing it, thus taking the responsibility to free it yourself.</p>
</div>
<div class="paragraph">
<p><strong>In the Castle Game Engine</strong>: The descendants of <code>TX3DNode</code> have automatic memory management when inserted as children of another <code>TX3DNode</code>. The root X3D node, <code>TX3DRootNode</code>, is in turn usually owned by <code>TCastleSceneCore</code>. Some other things also have a simple ownership mechanism&#8201;&#8212;&#8201;look for parameters and properties called <code>OwnsXxx</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_virtual_destructor_called_destroy">5.4. The virtual destructor called Destroy</h3>
<div class="paragraph">
<p>As you saw in the examples above, when the class is destroyed, it&#8217;s <code>destructor</code> called <code>Destroy</code> is called.</p>
</div>
<div class="paragraph">
<p>In theory, you could have multiple destructors, but in practice it&#8217;s almost never a good idea. It&#8217;s much easier to have only one destructor called <code>Destroy</code>, which is in turn called by the <code>Free</code> method, which is in turn called by the <code>FreeAndNil</code> procedure.</p>
</div>
<div class="paragraph">
<p>The <code>Destroy</code> destructor in the <code>TObject</code> is defined as a <em>virtual</em> method, so you should always mark it with the <code>override</code> keyword in all your classes (since all classes descend from <code>TObject</code>). This makes the <code>Free</code> method work correctly. Recall how the virtual methods work from the <a href="#virtual-methods-section">Virtual methods, override and reintroduce</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This information about <em>destructors</em> is, indeed, inconsistent with the <em>constructors</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s normal that a class has multiple constructors. Usually they are all called <code>Create</code>, and only have different parameters, but it&#8217;s also OK to invent other names for constructors.</p>
</div>
<div class="paragraph">
<p>Also, the <code>Create</code> constructor in the <code>TObject</code> is <em>not virtual</em>, so you do not mark it with <code>override</code> in the descendants.</p>
</div>
<div class="paragraph">
<p>This all gives you a bit of extra flexibility when defining constructors. It is often not necessary to make them virtual, so by default you&#8217;re not forced to do it.</p>
</div>
<div class="paragraph">
<p>Note, however, that this changes for <code>TComponent</code> descendants. The <code>TComponent</code> defines a virtual constructor <code>Create(AOwner: TComponent)</code>. It needs a virtual constructor in order for the streaming system to work. When defining descendants of the <code>TComponent</code>, you should override this constructor (and mark it with the <code>override</code> keyword), and perform all your initialization inside it. It is still OK to define additional constructors, but they should only act as <em>"helpers"</em>. The instance should always work when created using the <code>Create(AOwner: TComponent)</code> constructor, otherwise it will not be correctly constructed when streaming. The <em>streaming</em> is used e.g. when saving and loading this component on a Lazarus form.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_free_notification">5.5. Free notification</h3>
<div class="paragraph">
<p>If you copy a reference to the instance, such that you have two references to the same memory, and then one of them is freed&#8201;&#8212;&#8201;the other one becomes a <em>"dangling pointer"</em>. It should not be accessed, as it points to a memory that is no longer allocated. Accessing it may result in a runtime error, or garbage being returned (as the memory may be reused for other stuff in your program).</p>
</div>
<div class="paragraph">
<p>Using the <code>FreeAndNil</code> to free the instance doesn&#8217;t help here. <code>FreeAndNil</code> sets to <code>nil</code> only the reference it got&#8201;&#8212;&#8201;there&#8217;s no way for it to set all other references. Consider this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  O1, O2: TObject;
<span class="keyword">begin</span>
  O1 := TObject.Create;
  O2 := O1;
  FreeAndNil(O1);

  <span class="comment">// what happens if we access O1 or O2 here?</span>
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At the end of this block, the <code>O1</code> is <code>nil</code>. If some code has to access it, it can reliably use <code>if O1 &lt;&gt; nil &#8230;&#8203;</code> to avoid calling methods on a freed instance, like</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">if</span> O1 &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
  Writeln(O1.ClassName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Trying to access a field of a <code>nil</code> instance results in a predictable exception at runtime. So even if some code will not check <code>O1 &lt;&gt; nil</code>, and will blindly access <code>O1</code> field, you will get a clear exception at runtime.</p>
</div>
<div class="paragraph">
<p>Same goes for calling a virtual method, or calling a non-virtual method that accessed a field of a <code>nil</code> instance.</p>
</div>
</li>
<li>
<p>With <code>O2</code>, things are less predictable. It&#8217;s not <code>nil</code>, but it&#8217;s invalid. Trying to access a field of a non-nil invalid instance
results in an unpredictable behavior&#8201;&#8212;&#8201;maybe an access violation exception, maybe a garbage data returned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are various solutions to it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One solution is to, well, be careful and read the documentation. Don&#8217;t assume anything about the lifetime of the reference, if it&#8217;s created by other code. If a class <code>TCar</code> has a field pointing to some instance of <code>TWheel</code>, it&#8217;s a <em>convention</em> that the reference to <em>wheel</em> is valid as long as the reference to <em>car</em> exists, and the <em>car</em> will free it&#8217;s <em>wheels</em> inside it&#8217;s destructor. But that&#8217;s just a convention, the documentation should mention if there&#8217;s something more complicated going on.</p>
</li>
<li>
<p>In the above example, right after freeing the <code>O1</code> instance, you can simply set the <code>O2</code> variable explicitly to <code>nil</code>. That&#8217;s trivial in this simple case.</p>
</li>
<li>
<p>The most future-proof solution is to use <code>TComponent</code> class "free notification" mechanism. One component can be notified when another component is freed, and thus set it&#8217;s reference to <code>nil</code>.</p>
<div class="paragraph">
<p>Thus you get something like a <em>weak reference</em>. It can cope with various usage scenarios, for example you can let the code from outside of the class to set your reference, and the outside code can also free the instance at anytime.</p>
</div>
<div class="paragraph">
<p>This requires both classes to descend from <code>TComponent</code>. Using it in general boils down to calling <code>FreeNotification</code> , <code>RemoveFreeNotification</code>, and overriding <code>Notification</code>.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a complete example, showing how to use this mechanism, together with constructor / destructor and a setter property. Sometimes it can be done simpler, but this is the full-blown version that is always correct:)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TControl = <span class="keyword">class</span>(TComponent)
  <span class="keyword">end</span>;

  TContainer = <span class="keyword">class</span>(TComponent)
  <span class="directive">private</span>
    FSomeSpecialControl: TControl;
    <span class="keyword">procedure</span> SetSomeSpecialControl(<span class="keyword">const</span> Value: TControl);
  <span class="directive">protected</span>
    <span class="keyword">procedure</span> Notification(AComponent: TComponent; Operation: TOperation); <span class="directive">override</span>;
  <span class="directive">public</span>
    <span class="keyword">destructor</span> Destroy; <span class="directive">override</span>;
    <span class="keyword">property</span> SomeSpecialControl: TControl
      <span class="directive">read</span> FSomeSpecialControl <span class="directive">write</span> SetSomeSpecialControl;
  <span class="keyword">end</span>;

<span class="keyword">implementation</span>

<span class="keyword">procedure</span> TContainer.Notification(AComponent: TComponent; Operation: TOperation);
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  <span class="keyword">if</span> (Operation = opRemove) <span class="keyword">and</span> (AComponent = FSomeSpecialControl) <span class="keyword">then</span>
    <span class="comment">{ set to nil by SetSomeSpecialControl to clean nicely }</span>
    SomeSpecialControl := <span class="keyword">nil</span>;
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TContainer.SetSomeSpecialControl(<span class="keyword">const</span> Value: TControl);
<span class="keyword">begin</span>
  <span class="keyword">if</span> FSomeSpecialControl &lt;&gt; Value <span class="keyword">then</span>
  <span class="keyword">begin</span>
    <span class="keyword">if</span> FSomeSpecialControl &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
      FSomeSpecialControl.RemoveFreeNotification(Self);
    FSomeSpecialControl := Value;
    <span class="keyword">if</span> FSomeSpecialControl &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
      FSomeSpecialControl.FreeNotification(Self);
  <span class="keyword">end</span>;
<span class="keyword">end</span>;

<span class="keyword">destructor</span> TContainer.Destroy;
<span class="keyword">begin</span>
  <span class="comment">{ set to nil by SetSomeSpecialControl, to detach free notification }</span>
  SomeSpecialControl := <span class="keyword">nil</span>;
  <span class="keyword">inherited</span>;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_time_library">6. Run-time library</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_input_output_using_streams">6.1. Input/output using streams</h3>
<div class="paragraph">
<p>Modern programs should use <code>TStream</code> class and it&#8217;s many descendants to do input / output. It has many useful descendants, like <code>TFileStream</code>, <code>TMemoryStream</code>, <code>TStringStream</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Classes;
<span class="keyword">var</span>
  S: TStream;
  InputInt, OutputInt: Integer;
<span class="keyword">begin</span>
  InputInt := <span class="integer">666</span>;

  S := TFileStream.Create(<span class="string"><span class="delimiter">'</span><span class="content">my_binary_file.data</span><span class="delimiter">'</span></span>, fmCreate);
  <span class="keyword">try</span>
    S.WriteBuffer(InputInt, SizeOf(InputInt));
  <span class="keyword">finally</span> FreeAndNil(S) <span class="keyword">end</span>;

  S := TFileStream.Create(<span class="string"><span class="delimiter">'</span><span class="content">my_binary_file.data</span><span class="delimiter">'</span></span>, fmOpenRead);
  <span class="keyword">try</span>
    S.ReadBuffer(OutputInt, SizeOf(OutputInt));
  <span class="keyword">finally</span> FreeAndNil(S) <span class="keyword">end</span>;

  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Read from file got integer: </span><span class="delimiter">'</span></span>, OutputInt);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>In the Castle Game Engine</strong>: You should use the <code>Download</code> method to create a stream that operates of resources (which includes files, data downloaded from URLs and Android assets). Moreover, to open the resource inside your game data (typically in <code>data</code> subdirectory) use the <code>ApplicationData</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">EnableNetwork := true;
S := Download(<span class="string"><span class="delimiter">'</span><span class="content">https://castle-engine.sourceforge.io/latest.zip</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">S := Download(<span class="string"><span class="delimiter">'</span><span class="content">file:///home/michalis/my_binary_file.data</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">S := Download(ApplicationData(<span class="string"><span class="delimiter">'</span><span class="content">gui/my_image.png</span><span class="delimiter">'</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To read text files, we advice using the <code>TTextReader</code> class. It provides a line-oriented API, and wraps a <code>TStream</code> inside. The <code>TTextReader</code> constructor can take a ready URL, or you can pass there your custom <code>TStream</code> source.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">Text := TTextReader.Create(ApplicationData(<span class="string"><span class="delimiter">'</span><span class="content">my_data.txt</span><span class="delimiter">'</span></span>));
<span class="keyword">while</span> <span class="keyword">not</span> Text.Eof <span class="keyword">do</span>
  WritelnLog(<span class="string"><span class="delimiter">'</span><span class="content">NextLine</span><span class="delimiter">'</span></span>, Text.ReadLine);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generic-containers-section">6.2. Containers (lists, dictionaries) using generics</h3>
<div class="paragraph">
<p>The language and run-time library offer various flexible containers. There are a number of non-generic classes (like <code>TList</code> and <code>TObjectList</code> from the <code>Contnrs</code> unit), there are also dynamic arrays (<code>array of TMyType</code>). But to get the most flexibility <strong>and</strong> type-safety, I advice using <strong>generic containers</strong> for most of your needs.</p>
</div>
<div class="paragraph">
<p>The <em>generic containers</em> give you a lot of helpful methods to add, remove, iterate, search, sort&#8230;&#8203; The compiler also knows (and checks) that the container holds only items of the appropriate type.</p>
</div>
<div class="paragraph">
<p>There are three libraries providing generics containers in FPC now:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FGL</code> unit</p>
</li>
<li>
<p><code>Generics.Collections</code> unit and friends</p>
</li>
<li>
<p><code>GVector</code> unit and friends (together in <code>fcl-stl</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We advice using the <code>FGL</code> unit (if you need to work with the latest stable FPC 3.0.0 and 3.0.2 or even older FPC 2.6.x), or the <code>Generics.Collections</code> unit (only available since FPC 3.1.1, but on the other hand compatible with Delphi). They both offer lists and dictionaries with naming consistent with other parts of the standard library (like the non-generic containers from the <code>Contnrs</code> unit).</p>
</div>
<div class="paragraph">
<p><strong>In the Castle Game Engine</strong>: We include a local copy of <code>Generics.Collections</code> even for FPC 3.0.0 and 3.0.2. We use the <code>Generics.Collections</code> throughout the engine, and advice you to use <code>Generics.Collections</code> too!</p>
</div>
<div class="paragraph">
<p>Most important classes from the <code>Generics.Collections</code> unit are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TList</dt>
<dd>
<p>A generic list of types.</p>
</dd>
<dt class="hdlist1">TObjectList</dt>
<dd>
<p>A generic list of object instances. It can "own" children, which means that it will free them automatically.</p>
</dd>
<dt class="hdlist1">TDictionary</dt>
<dd>
<p>A generic dictionary.</p>
</dd>
<dt class="hdlist1">TObjectDictionary</dt>
<dd>
<p>A generic dictionary, that can "own" the keys and/or values.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here&#8217;s how to you use a simple generic <code>TObjectList</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Generics.Collections;

<span class="keyword">type</span>
  TApple = <span class="keyword">class</span>
    Name: <span class="keyword">string</span>;
  <span class="keyword">end</span>;

  TAppleList = specialize TObjectList&lt;TApple&gt;;

<span class="keyword">var</span>
  A: TApple;
  Apples: TAppleList;
<span class="keyword">begin</span>
  Apples := TAppleList.Create(true);
  <span class="keyword">try</span>
    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">my apple</span><span class="delimiter">'</span></span>;
    Apples.Add(A);

    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">another apple</span><span class="delimiter">'</span></span>;
    Apples.Add(A);

    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Count: </span><span class="delimiter">'</span></span>, Apples.Count);
    Writeln(Apples[<span class="integer">0</span>].Name);
    Writeln(Apples[<span class="integer">1</span>].Name);
  <span class="keyword">finally</span> FreeAndNil(Apples) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that some operations require comparing two items, like sorting and searching (e.g. by <code>Sort</code> and <code>IndexOf</code> methods). The <code>Generics.Collections</code> containers use for this a <em>comparer</em>. The <em>default comparer</em> is reasonable for all types, even for records (in which case it compares memory contents, which is a reasonable default at least for searching using <code>IndexOf</code>).</p>
</div>
<div class="paragraph">
<p>When sorting the list you can provide a <em>custom comparer</em> as a parameter. The <em>comparer</em> is a class implementing the <code>IComparer</code> interface. In practice, you usually define the appropriate callback, and use <code>TComparer&lt;T&gt;.Construct</code> method to wrap this callback into an <code>IComparer</code> instance. An example of doing this is below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Generics.Defaults, Generics.Collections;

<span class="keyword">type</span>
  TApple = <span class="keyword">class</span>
    Name: <span class="keyword">string</span>;
  <span class="keyword">end</span>;

  TAppleList = specialize TObjectList&lt;TApple&gt;;

<span class="keyword">function</span> CompareApples(constref Left, Right: TApple): Integer;
<span class="keyword">begin</span>
  Result := AnsiCompareStr(Left.Name, Right.Name);
<span class="keyword">end</span>;

<span class="keyword">type</span>
  TAppleComparer = specialize TComparer&lt;TApple&gt;;
<span class="keyword">var</span>
  A: TApple;
  L: TAppleList;
<span class="keyword">begin</span>
  L := TAppleList.Create(true);
  <span class="keyword">try</span>
    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">11</span><span class="delimiter">'</span></span>;
    L.Add(A);

    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">33</span><span class="delimiter">'</span></span>;
    L.Add(A);

    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">22</span><span class="delimiter">'</span></span>;
    L.Add(A);

    L.Sort(TAppleComparer.Construct(@CompareApples));

    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Count: </span><span class="delimiter">'</span></span>, L.Count);
    Writeln(L[<span class="integer">0</span>].Name);
    Writeln(L[<span class="integer">1</span>].Name);
    Writeln(L[<span class="integer">2</span>].Name);
  <span class="keyword">finally</span> FreeAndNil(L) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TDictionary</code> class implements a <strong>dictionary</strong>, also known as a <strong>map (key &#8594; value)</strong>, also known as an <strong>associative array</strong>. It&#8217;s API is a bit similar to the C# <code>TDictionary</code> class. It has useful iterators for keys, values, and pairs of key&#8594;value.</p>
</div>
<div class="paragraph">
<p>An example code using a dictionary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Generics.Collections;

<span class="keyword">type</span>
  TApple = <span class="keyword">class</span>
    Name: <span class="keyword">string</span>;
  <span class="keyword">end</span>;

  TAppleDictionary = specialize TDictionary&lt;<span class="keyword">string</span>, TApple&gt;;

<span class="keyword">var</span>
  Apples: TAppleDictionary;
  A, FoundA: TApple;
  ApplePair: TAppleDictionary.TDictionaryPair;
  AppleKey: <span class="keyword">string</span>;
<span class="keyword">begin</span>
  Apples := TAppleDictionary.Create;
  <span class="keyword">try</span>
    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">my apple</span><span class="delimiter">'</span></span>;
    Apples.AddOrSetValue(<span class="string"><span class="delimiter">'</span><span class="content">apple key 1</span><span class="delimiter">'</span></span>, A);

    <span class="keyword">if</span> Apples.TryGetValue(<span class="string"><span class="delimiter">'</span><span class="content">apple key 1</span><span class="delimiter">'</span></span>, FoundA) <span class="keyword">then</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Found apple under key &quot;apple key 1&quot; with name: </span><span class="delimiter">'</span></span> +
        FoundA.Name);

    <span class="keyword">for</span> AppleKey <span class="keyword">in</span> Apples.Keys <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Found apple key: </span><span class="delimiter">'</span></span> + AppleKey);
    <span class="keyword">for</span> A <span class="keyword">in</span> Apples.Values <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Found apple value: </span><span class="delimiter">'</span></span> + A.Name);
    <span class="keyword">for</span> ApplePair <span class="keyword">in</span> Apples <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Found apple key-&gt;value: </span><span class="delimiter">'</span></span> +
        ApplePair.Key + <span class="string"><span class="delimiter">'</span><span class="content">-&gt;</span><span class="delimiter">'</span></span> + ApplePair.Value.Name);

    <span class="comment">{ Line below works too, but it can only be used to set
      an *existing* dictionary key.
      Instead of this, usually use AddOrSetValue
      to set or add a new key, as necessary. }</span>
    <span class="comment">// Apples['apple key 1'] := ... ;</span>

    Apples.Remove(<span class="string"><span class="delimiter">'</span><span class="content">apple key 1</span><span class="delimiter">'</span></span>);

    <span class="comment">{ Note that the TDictionary doesn't own the items,
      you need to free them yourself.
      We could use TObjectDictionary to have automatic ownership
      mechanism. }</span>
    A.Free;
  <span class="keyword">finally</span> FreeAndNil(Apples) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TObjectDictionary</code> can additionally <em>own</em> the dictionary keys and/or values, which means that they will be automatically freed. Be careful to <em>only own keys and/or values if they are object instances</em>. If you set to <em>"owned"</em> some other type, like an <code>Integer</code> (for example, if your keys are <code>Integer</code>, and you include <code>doOwnsKeys</code>), you will get a nasty crash when the code executes.</p>
</div>
<div class="paragraph">
<p>An example code using the <code>TObjectDictionary</code> is below. Compile this example with <em>memory leak detection</em>, like <code>fpc -gl -gh generics_object_dictionary.lpr</code>, to see that everything is freed when program exits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Generics.Collections;

<span class="keyword">type</span>
  TApple = <span class="keyword">class</span>
    Name: <span class="keyword">string</span>;
  <span class="keyword">end</span>;

  TAppleDictionary = specialize TObjectDictionary&lt;<span class="keyword">string</span>, TApple&gt;;

<span class="keyword">var</span>
  Apples: TAppleDictionary;
  A: TApple;
  ApplePair: TAppleDictionary.TDictionaryPair;
<span class="keyword">begin</span>
  Apples := TAppleDictionary.Create([doOwnsValues]);
  <span class="keyword">try</span>
    A := TApple.Create;
    A.Name := <span class="string"><span class="delimiter">'</span><span class="content">my apple</span><span class="delimiter">'</span></span>;
    Apples.AddOrSetValue(<span class="string"><span class="delimiter">'</span><span class="content">apple key 1</span><span class="delimiter">'</span></span>, A);

    <span class="keyword">for</span> ApplePair <span class="keyword">in</span> Apples <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Found apple key-&gt;value: </span><span class="delimiter">'</span></span> +
        ApplePair.Key + <span class="string"><span class="delimiter">'</span><span class="content">-&gt;</span><span class="delimiter">'</span></span> + ApplePair.Value.Name);

    Apples.Remove(<span class="string"><span class="delimiter">'</span><span class="content">apple key 1</span><span class="delimiter">'</span></span>);
  <span class="keyword">finally</span> FreeAndNil(Apples) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer using the <code>FGL</code> unit instead of <code>Generics.Collections</code>, here is a short overview of the most important classes from the <code>FGL</code> unit:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TFPGList</dt>
<dd>
<p>A generic list of types.</p>
</dd>
<dt class="hdlist1">TFPGObjectList</dt>
<dd>
<p>A generic list of object instances. It can "own" children.</p>
</dd>
<dt class="hdlist1">TFPGMap</dt>
<dd>
<p>A generic dictionary.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In <code>FGL</code> unit, the <code>TFPGList</code> can be only used for types for which the equality operator (=) is defined. For <code>TFPGMap</code> the <em>"greater than"</em> (&gt;) and <em>"less than"</em> (&lt;) operators must be defined for the key type. If you want to use these lists with types that don&#8217;t have built-in comparison operators (e.g. with records), you have to overload their operators as shown in the <a href="#_operator_overloading">Operator overloading</a>.</p>
</div>
<div class="paragraph">
<p><strong>In the Castle Game Engine</strong> we include a unit <code>CastleGenericLists</code> that adds <code>TGenericStructList</code> and <code>TGenericStructMap</code> classes. They are similar to <code>TFPGList</code> and <code>TFPGMap</code>, but they do not require a definition of the comparison operators for the appropriate type (instead, they compare memory contents, which is often appropriate for records or method pointers). But the <code>CastleGenericLists</code> unit is deprecated since the engine version 6.3, as we advice using <code>Generics.Collections</code> instead.</p>
</div>
<div class="paragraph">
<p>If you want to know more about the generics, see <a href="#_generics">Generics</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cloning_tpersistent_assign">6.3. Cloning: TPersistent.Assign</h3>
<div class="paragraph">
<p>Copying the class instances by a simple assignment operator copies the <strong>reference</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  X, Y: TMyObject;
<span class="keyword">begin</span>
  X := TMyObject.Create;
  Y := X;
  <span class="comment">// X and Y are now two pointers to the same data</span>
  Y.MyField := <span class="integer">123</span>; <span class="comment">// this also changes X.MyField</span>
  FreeAndNil(X);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To copy the <strong>class instance contents</strong>, the standard approach is to derive your class from <code>TPersistent</code>, and override it&#8217;s <code>Assign</code> method. Once it&#8217;s implemented properly in <code>TMyObject</code>, you use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">var</span>
  X, Y: TMyObject;
<span class="keyword">begin</span>
  X := TMyObject.Create;
  Y := TMyObject.Create;
  Y.Assign(X);
  Y.MyField := <span class="integer">123</span>; <span class="comment">// this does not change X.MyField</span>
  FreeAndNil(X);
  FreeAndNil(Y);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make it work, you need to implement the <code>Assign</code> method to actually copy the fields you want. You should carefully implement the <code>Assign</code> method, to copy from a class that may be a descendant of the current class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils, Classes;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>(TPersistent)
  <span class="directive">public</span>
    MyInt: Integer;
    <span class="keyword">procedure</span> Assign(Source: TPersistent); <span class="directive">override</span>;
  <span class="keyword">end</span>;

  TMyClassDescendant = <span class="keyword">class</span>(TMyClass)
  <span class="directive">public</span>
    MyString: <span class="keyword">string</span>;
    <span class="keyword">procedure</span> Assign(Source: TPersistent); <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.Assign(Source: TPersistent);
<span class="keyword">var</span>
  SourceMyClass: TMyClass;
<span class="keyword">begin</span>
  <span class="keyword">if</span> Source <span class="keyword">is</span> TMyClass <span class="keyword">then</span>
  <span class="keyword">begin</span>
    SourceMyClass := TMyClass(Source);
    MyInt := SourceMyClass.MyInt;
    <span class="comment">// Xxx := SourceMyClass.Xxx; // add new fields here</span>
  <span class="keyword">end</span> <span class="keyword">else</span>
    <span class="comment">{ Since TMyClass is a direct TPersistent descendant,
      it calls inherited ONLY when it cannot handle Source class.
      See comments below. }</span>
    <span class="keyword">inherited</span> Assign(Source);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClassDescendant.Assign(Source: TPersistent);
<span class="keyword">var</span>
  SourceMyClassDescendant: TMyClassDescendant;
<span class="keyword">begin</span>
  <span class="keyword">if</span> Source <span class="keyword">is</span> TMyClassDescendant <span class="keyword">then</span>
  <span class="keyword">begin</span>
    SourceMyClassDescendant := TMyClassDescendant(Source);
    MyString := SourceMyClassDescendant.MyString;
    <span class="comment">// Xxx := SourceMyClassDescendant.Xxx; // add new fields here</span>
  <span class="keyword">end</span>;

  <span class="comment">{ Since TMyClassDescendant has an ancestor that already overrides
    Assign (in TMyClass.Assign), it calls inherited ALWAYS,
    to allow TMyClass.Assign to handle remaining fields.
    See comments below for a detailed reasoning. }</span>
  <span class="keyword">inherited</span> Assign(Source);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C1, C2: TMyClass;
  CD1, CD2: TMyClassDescendant;
<span class="keyword">begin</span>
  <span class="comment">// test TMyClass.Assign</span>
  C1 := TMyClass.Create;
  C2 := TMyClass.Create;
  <span class="keyword">try</span>
    C1.MyInt := <span class="integer">666</span>;
    C2.Assign(C1);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">C2 state: </span><span class="delimiter">'</span></span>, C2.MyInt);
  <span class="keyword">finally</span>
    FreeAndNil(C1);
    FreeAndNil(C2);
  <span class="keyword">end</span>;

  <span class="comment">// test TMyClassDescendant.Assign</span>
  CD1 := TMyClassDescendant.Create;
  CD2 := TMyClassDescendant.Create;
  <span class="keyword">try</span>
    CD1.MyInt := <span class="integer">44</span>;
    CD1.MyString := <span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>;
    CD2.Assign(CD1);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">CD2 state: </span><span class="delimiter">'</span></span>, CD2.MyInt, <span class="char"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>, CD2.MyString);
  <span class="keyword">finally</span>
    FreeAndNil(CD1);
    FreeAndNil(CD2);
  <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes it&#8217;s more comfortable to alternatively override the <code>AssignTo</code> method in the source class, instead of overriding the <code>Assign</code> method in the destination class.</p>
</div>
<div class="paragraph">
<p>Be careful when you call <code>inherited</code> in the overridden <code>Assign</code> implementation. There are two situations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Your class is a direct descendant of the <code>TPersistent</code> class. (Or, it&#8217;s not a direct descendant of <code>TPersistent</code>, but no ancestor has overridden the <code>Assign</code> method.)</dt>
<dd>
<p>In this case, your class should use the <code>inherited</code> keyword (to call the <code>TPersistent.Assign</code>) <em>only if you cannot handle the assignment in your code</em>.</p>
</dd>
<dt class="hdlist1">Your class descends from some class that has already overridden the <code>Assign</code> method.</dt>
<dd>
<p>In this case, your class should <em>always</em> use the <code>inherited</code> keyword (to call the ancestor <code>Assign</code>). In general, calling <code>inherited</code> in overridden methods is <em>usually</em> a good idea.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To understand the need when to call (or not to call) <code>inherited</code> from the <code>Assign</code> implementation, and how it relates to the <code>AssignTo</code> method, it&#8217;s best to look at the <code>TPersistent.Assign</code> and <code>TPersistent.AssignTo</code> implementations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">procedure</span> TPersistent.Assign(Source: TPersistent);
<span class="keyword">begin</span>
  <span class="keyword">if</span> Source &lt;&gt; <span class="keyword">nil</span> <span class="keyword">then</span>
    Source.AssignTo(Self)
  <span class="keyword">else</span>
    <span class="keyword">raise</span> EConvertError...
end;

<span class="keyword">procedure</span> TPersistent.AssignTo(Destination: TPersistent);
<span class="keyword">begin</span>
  <span class="keyword">raise</span> EConvertError...
end;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is not the <strong>exact</strong> implementation of <code>TPersistent</code>, I simplified it to hide the boring details about how the exception message is build.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The conclusions you can get from the above are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If neither <code>Assign</code> nor <code>AssignTo</code> are overridden</em>, then calling them will result in an exception.</p>
</li>
<li>
<p>Also, note that there is <em>no</em> code in <code>TPersistent</code> implementation that automatically copies all the fields (or all the published fields) of the classes. That&#8217;s why you need to do that yourself, by overriding <code>Assign</code> in all the classes. You can use RTTI (runtime type information) for that, but for simple cases you will probably just list the fields to be copied manually.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you have a class like <code>TApple</code>, your <code>TApple.Assign</code> implementation usually deals with copying fields that are specific to the <code>TApple</code> class (not to the <code>TApple</code> ancestor, like <code>TFruit</code>). So, the <code>TApple.Assign</code> implementation usually checks whether <code>Source is TApple</code> at the beginning, before copying apple-related fields. Then, it calls <code>inherited</code> to allow <code>TFruit</code> to handle the rest of the fields.</p>
</div>
<div class="paragraph">
<p>Assuming that you implemented <code>TFruit.Assign</code> and <code>TApple.Assign</code> following the standard pattern (as shown in the example above), the effect is like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you pass <code>TApple</code> instance to <code>TApple.Assign</code>, it will work and copy all the fields.</p>
</li>
<li>
<p>If you pass <code>TOrange</code> instance to <code>TApple.Assign</code>, it will work and only copy the common fields shared by both <code>TOrange</code> and <code>TApple</code>. In other words, the fields defined at <code>TFruit</code>.</p>
</li>
<li>
<p>If you pass <code>TWerewolf</code> instance to <code>TApple.Assign</code>, it will raise an exception (because <code>TApple.Assign</code> will call <code>TFruit.Assign</code> which will call <code>TPersistent.Assign</code> which raises an exception).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Remember that when descending from <code>TPersistent</code>, the default <em>visibility specifier</em> is <code>published</code>, to allow streaming of <code>TPersistent</code> descendants. Not all field and property types are allowed in the <code>published</code> section. If you get errors related to it, and you don&#8217;t care about streaming, just change the visibility to <code>public</code>. See the <a href="#_visibility_specifiers">Visibility specifiers</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_various_language_features">7. Various language features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_local_nested_routines">7.1. Local (nested) routines</h3>
<div class="paragraph">
<p>Inside a larger <em>routine</em> (function, procedure, method) you can define a helper routine.</p>
</div>
<div class="paragraph">
<p>The local routine can freely access (read and write) all the parameters of a parent, <em>and all the local variables of the parent that were declared above it</em>. This is very powerful. It often allows to split long routines into a couple of small ones without much effort (as you don&#8217;t have to pass around all the necessary information in the parameters). Be careful to not overuse this feature&#8201;&#8212;&#8201;if many nested functions use (and even change) the same variable of the parent, the code may get hard to follow.</p>
</div>
<div class="paragraph">
<p>These two examples are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">procedure</span> SumOfSquares(<span class="keyword">const</span> N: Integer): Integer;

  <span class="keyword">function</span> Square(<span class="keyword">const</span> Value: Integer): Integer;
  <span class="keyword">begin</span>
    Result := Value * Value;
  <span class="keyword">end</span>;

<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  Result := <span class="integer">0</span>;
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> N <span class="keyword">do</span>
    Result := Result + Square(I);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another version, where we let the local routine <code>Square</code> to access <code>I</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">procedure</span> SumOfSquares(<span class="keyword">const</span> N: Integer): Integer;
<span class="keyword">var</span>
  I: Integer;

  <span class="keyword">function</span> Square: Integer;
  <span class="keyword">begin</span>
    Result := I * I;
  <span class="keyword">end</span>;

<span class="keyword">begin</span>
  Result := <span class="integer">0</span>;
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> N <span class="keyword">do</span>
    Result := Result + Square;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Local routines can go to any depth&#8201;&#8212;&#8201;which means that you can define a local routine within another local routine. So you can go wild (but please don&#8217;t go <em>too wild</em>, or the code will get unreadable:).</p>
</div>
</div>
<div class="sect2">
<h3 id="Callbacks">7.2. Callbacks (aka events, aka pointers to functions, aka procedural variables)</h3>
<div class="paragraph">
<p>They allow to call a function indirectly, through to a variable. The variable can be assigned at runtime to point to any function <em>with matching parameter types and return types</em>.</p>
</div>
<div class="paragraph">
<p>The callback can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Normal, which means it can point to any normal routine (not a method, not local).</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>

<span class="keyword">function</span> Add(<span class="keyword">const</span> A, B: Integer): Integer;
<span class="keyword">begin</span>
  Result := A + B;
<span class="keyword">end</span>;

<span class="keyword">function</span> Multiply(<span class="keyword">const</span> A, B: Integer): Integer;
<span class="keyword">begin</span>
  Result := A * B;
<span class="keyword">end</span>;

<span class="keyword">type</span>
  TMyFunction = <span class="keyword">function</span> (<span class="keyword">const</span> A, B: Integer): Integer;

<span class="keyword">function</span> ProcessTheList(<span class="keyword">const</span> F: TMyFunction): Integer;
<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  Result := <span class="integer">1</span>;
  <span class="keyword">for</span> I := <span class="integer">2</span> <span class="keyword">to</span> <span class="integer">10</span> <span class="keyword">do</span>
    Result := F(Result, I);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  SomeFunction: TMyFunction;
<span class="keyword">begin</span>
  SomeFunction := @Add;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">1 + 2 + 3 ... + 10 = </span><span class="delimiter">'</span></span>, ProcessTheList(SomeFunction));

  SomeFunction := @Multiply;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">1 * 2 * 3 ... * 10 = </span><span class="delimiter">'</span></span>, ProcessTheList(SomeFunction));
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</li>
<li>
<p>A method: declare with <code>of object</code> at the end.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyMethod = <span class="keyword">procedure</span> (<span class="keyword">const</span> A: Integer) <span class="keyword">of</span> <span class="keyword">object</span>;

  TMyClass = <span class="keyword">class</span>
    CurrentValue: Integer;
    <span class="keyword">procedure</span> Add(<span class="keyword">const</span> A: Integer);
    <span class="keyword">procedure</span> Multiply(<span class="keyword">const</span> A: Integer);
    <span class="keyword">procedure</span> ProcessTheList(<span class="keyword">const</span> M: TMyMethod);
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.Add(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  CurrentValue := CurrentValue + A;
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.Multiply(<span class="keyword">const</span> A: Integer);
<span class="keyword">begin</span>
  CurrentValue := CurrentValue * A;
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass.ProcessTheList(<span class="keyword">const</span> M: TMyMethod);
<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  CurrentValue := <span class="integer">1</span>;
  <span class="keyword">for</span> I := <span class="integer">2</span> <span class="keyword">to</span> <span class="integer">10</span> <span class="keyword">do</span>
    M(I);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C: TMyClass;
<span class="keyword">begin</span>
  C := TMyClass.Create;
  <span class="keyword">try</span>
    C.CurrentValue := <span class="integer">1</span>;
    C.ProcessTheList(@C.Add);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">1 + 2 + 3 ... + 10 = </span><span class="delimiter">'</span></span>, C.CurrentValue);

    C.CurrentValue := <span class="integer">1</span>;
    C.ProcessTheList(@C.Multiply);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">1 * 2 * 3 ... * 10 = </span><span class="delimiter">'</span></span>, C.CurrentValue);
  <span class="keyword">finally</span> FreeAndNil(C) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you <em>cannot</em> pass global procedures / functions as methods. They are incompatible. If you have to provide an <code>of object</code> callback, but don&#8217;t want to create a dummy class instance, you can pass <a href="#_class_methods">Class methods</a> as methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyMethod = <span class="keyword">function</span> (<span class="keyword">const</span> A, B: Integer): Integer <span class="keyword">of</span> <span class="keyword">object</span>;

  TMyClass = <span class="keyword">class</span>
    <span class="keyword">class</span> <span class="keyword">function</span> Add(<span class="keyword">const</span> A, B: Integer): Integer
    <span class="keyword">class</span> <span class="keyword">function</span> Multiply(<span class="keyword">const</span> A, B: Integer): Integer
  <span class="keyword">end</span>;

<span class="keyword">var</span>
  M: TMyMethod;
<span class="keyword">begin</span>
  M := @TMyClass(<span class="keyword">nil</span>).Add;
  M := @TMyClass(<span class="keyword">nil</span>).Multiply;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, you need to write ugly <code>@TMyClass(nil).Add</code> instead of just <code>@TMyClass.Add</code>.</p>
</div>
</li>
<li>
<p>A (possibly) local routine: declare with <code>is nested</code> at the end, and make sure to use <code>{$modeswitch nestedprocvars}</code> directive for the code. These go hand-in-hand with <a href="#_local_nested_routines">Local (nested) routines</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_generics">7.3. Generics</h3>
<div class="paragraph">
<p>A powerful feature of any modern language. The definition of something (typically, of a class) can be parameterized with another type. The most typical example is when you need to create a container (a list, dictionary, tree, graph&#8230;&#8203;): you can define <em>a list of type T</em>, and then <em>specialize</em> it to instantly get <em>a list of integers</em>, <em>a list of strings</em>, <em>a list of TMyRecord</em>, and so on.</p>
</div>
<div class="paragraph">
<p>The generics in Pascal are realized much like generics in C++. Which means that they are <em>"expanded"</em> at the specialization time, a <em>little</em> like macros (but much safer than macros; for example, the identifiers are resolved at the time of generic definition, not at specialization, so you cannot "inject" any unexpected behavior when specializing the generic). In effect this means that they are very fast (can be optimized for each particular type)  and work with types of any size. You can use a primitive type (integer, float) as well as a record as well as a class when specializing a generic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  generic TMyCalculator&lt;T&gt; = <span class="keyword">class</span>
    Value: T;
    <span class="keyword">procedure</span> Add(<span class="keyword">const</span> A: T);
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyCalculator.Add(<span class="keyword">const</span> A: T);
<span class="keyword">begin</span>
  Value := Value + A;
<span class="keyword">end</span>;

<span class="keyword">type</span>
  TMyFloatCalculator = specialize TMyCalculator&lt;Single&gt;;
  TMyStringCalculator = specialize TMyCalculator&lt;<span class="keyword">string</span>&gt;;

<span class="keyword">var</span>
  FloatCalc: TMyFloatCalculator;
  StringCalc: TMyStringCalculator;
<span class="keyword">begin</span>
  FloatCalc := TMyFloatCalculator.Create;
  <span class="keyword">try</span>
    FloatCalc.Add(<span class="float">3.14</span>);
    FloatCalc.Add(<span class="integer">1</span>);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">FloatCalc: </span><span class="delimiter">'</span></span>, FloatCalc.Value:<span class="integer">1</span>:<span class="integer">2</span>);
  <span class="keyword">finally</span> FreeAndNil(FloatCalc) <span class="keyword">end</span>;

  StringCalc := TMyStringCalculator.Create;
  <span class="keyword">try</span>
    StringCalc.Add(<span class="string"><span class="delimiter">'</span><span class="content">something</span><span class="delimiter">'</span></span>);
    StringCalc.Add(<span class="string"><span class="delimiter">'</span><span class="content"> more</span><span class="delimiter">'</span></span>);
    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">StringCalc: </span><span class="delimiter">'</span></span>, StringCalc.Value);
  <span class="keyword">finally</span> FreeAndNil(StringCalc) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generics are not limited to classes, you can have generic functions and procedures as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="comment">{ Note: this example requires FPC 3.1.1 (will not compile with FPC 3.0.0 or older). }</span>

generic <span class="keyword">function</span> Min&lt;T&gt;(<span class="keyword">const</span> A, B: T): T;
<span class="keyword">begin</span>
  <span class="keyword">if</span> A &lt; B <span class="keyword">then</span>
    Result := A <span class="keyword">else</span>
    Result := B;
<span class="keyword">end</span>;

<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Min (1, 0): </span><span class="delimiter">'</span></span>, specialize Min&lt;Integer&gt;(<span class="integer">1</span>, <span class="integer">0</span>));
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Min (3.14, 5): </span><span class="delimiter">'</span></span>, specialize Min&lt;Single&gt;(<span class="float">3.14</span>, <span class="integer">5</span>):<span class="integer">1</span>:<span class="integer">2</span>);
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Min (</span><span class="char">''</span><span class="content">a</span><span class="char">''</span><span class="content">, </span><span class="char">''</span><span class="content">b</span><span class="char">''</span><span class="content">): </span><span class="delimiter">'</span></span>, specialize Min&lt;<span class="keyword">string</span>&gt;(<span class="char"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, <span class="char"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>));
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>See also the <a href="#generic-containers-section">Containers (lists, dictionaries) using generics</a> about important standard classes using generics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overloading">7.4. Overloading</h3>
<div class="paragraph">
<p>Methods (and global functions and procedures) with the same name are allowed, as long as they have different parameters. At compile time, the compiler detects which one you want to use, knowing the parameters you pass.</p>
</div>
<div class="paragraph">
<p>By default, the overloading uses the FPC approach, which means that all the methods in given namespace (a class or a unit) are equal, and hide the other methods in namespaces with less priority. For example, if you define a class with methods <code>Foo(Integer)</code> and <code>Foo(string)</code>, and it descends from a class with method <code>Foo(Float)</code>, then the users of your new class will not be able to access the method <code>Foo(Float)</code> easily (they still can --- if they typecast the class to it&#8217;s ancestor type). To overcome this, use the <code>overload</code> keyword.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preprocessor">7.5. Preprocessor</h3>
<div class="paragraph">
<p>You can use simple preprocessor directives for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>conditional compilation (code depending on platform, or some custom switches),</p>
</li>
<li>
<p>to include one file in another,</p>
</li>
<li>
<p>you can also use parameter-less macros.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that macros with parameters are not allowed. In general, you should avoid using the preprocessor stuff&#8230;&#8203; unless it&#8217;s really justified. The preprocessing happens before parsing, which means that you can "break" the normal syntax of the Pascal language. This is a powerful, but also somewhat dirty, feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">unit</span> PreprocessorStuff;
<span class="keyword">interface</span>

<span class="preprocessor">{$ifdef FPC}</span>
<span class="comment">{ This is only defined when compiled by FPC, not other compilers (like Delphi). }</span>
<span class="keyword">procedure</span> Foo;
<span class="preprocessor">{$endif}</span>

<span class="comment">{ Define a NewLine constant. Here you can see how the normal syntax of Pascal
  is &quot;broken&quot; by preprocessor directives. When you compile on Unix
  (includes Linux, Android, Mac OS X), the compiler sees this:

    const NewLine = #10;

  When you compile on Windows, the compiler sees this:

    const NewLine = #13#10;

  On other operating systems, the code will fail to compile,
  because a compiler sees this:

    const NewLine = ;

  It's a *good* thing that the compilation fails in this case -- if you
  will have to port the program to an OS that is not Unix, not Windows,
  you will be reminded by a compiler to choose the newline convention
  on that system. }</span>

<span class="keyword">const</span>
  NewLine =
    <span class="preprocessor">{$ifdef UNIX}</span> <span class="char">#10</span> <span class="preprocessor">{$endif}</span>
    <span class="preprocessor">{$ifdef MSWINDOWS}</span> <span class="char">#13</span><span class="char">#10</span> <span class="preprocessor">{$endif}</span> ;

<span class="preprocessor">{$define MY_SYMBOL}</span>

<span class="preprocessor">{$ifdef MY_SYMBOL}</span>
<span class="keyword">procedure</span> Bar;
<span class="preprocessor">{$endif}</span>

<span class="preprocessor">{$define CallingConventionMacro := unknown}</span>
<span class="preprocessor">{$ifdef UNIX}</span>
  <span class="preprocessor">{$define CallingConventionMacro := cdecl}</span>
<span class="preprocessor">{$endif}</span>
<span class="preprocessor">{$ifdef MSWINDOWS}</span>
  <span class="preprocessor">{$define CallingConventionMacro := stdcall}</span>
<span class="preprocessor">{$endif}</span>
<span class="keyword">procedure</span> RealProcedureName; CallingConventionMacro; <span class="directive">external</span> <span class="string"><span class="delimiter">'</span><span class="content">some_external_library</span><span class="delimiter">'</span></span>;

<span class="keyword">implementation</span>

<span class="preprocessor">{$include some_file.inc}</span>
<span class="comment">// $I is just a shortcut for $include</span>
<span class="preprocessor">{$I some_other_file.inc}</span>

<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Include files have commonly the <code>.inc</code> extension, and are used for two purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The include file may only contain other compiler directives, that "configure" your source code. For example you could create a file <code>myconfig.inc</code> with these contents:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span>
<span class="preprocessor">{$H+}</span>
<span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$modeswitch advancedrecords}</span>
<span class="preprocessor">{$ifndef VER3}</span>
  <span class="preprocessor">{$error This code can only be compiled using FPC version at least 3.x.}</span>
<span class="preprocessor">{$endif}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can include this file using <code>{$I myconfig.inc}</code> in all your sources.</p>
</div>
</li>
<li>
<p>The other common use is to split a large unit into many files, while still keeping it a single unit as far as the language rules are concerned. Do not overuse this technique&#8201;&#8212;&#8201;your first instinct should be to split a single unit into multiple units, not to split a single unit into multiple include files. Never the less, this is a useful technique.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It allows to avoid "exploding" the number of units, while still keeping your source code files short. For example, it may be better to have a single unit with <em>"commonly used UI controls"</em> than to create <em>one unit for each UI control class</em>, as the latter approach would make the typical "uses" clause long (since a typical UI code will depend on a couple of UI classes). But placing all these UI classes in a single <code>myunit.pas</code> file would make it a long file, unhandy to navigate, so splitting it into multiple include files may make sense.</p>
</li>
<li>
<p>It allows to have a cross-platform unit interface with platform-dependent implementation easily. Basically you can do</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$ifdef UNIX}</span> <span class="preprocessor">{$I my_unix_implementation.inc}</span> <span class="preprocessor">{$endif}</span>
<span class="preprocessor">{$ifdef MSWINDOWS}</span> <span class="preprocessor">{$I my_windows_implementation.inc}</span> <span class="preprocessor">{$endif}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes this is better than writing a long code with many <code>{$ifdef UNIX}</code>, <code>{$ifdef MSWINDOWS}</code> intermixed with normal code (variable declarations, routine implementation). The code is more readable this way. You can even use this technique more aggressively, by using the <code>-Fi</code> command-line option of FPC to include some subdirectories only for specific platforms. Then you can have many version of include file <code>{$I my platform_specific_implementation.inc}</code> and you simply include them, letting the compiler find the correct version.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_records">7.6. Records</h3>
<div class="paragraph">
<p><em>Record</em> is just a container for other variables. It&#8217;s like a much, much simplified <em>class</em>: there is no inheritance or virtual methods. It is like a <em>structure</em> in C-like languages.</p>
</div>
<div class="paragraph">
<p>If you use the <code>{$modeswitch advancedrecords}</code> directive, records <strong>can</strong> have methods and visibility specifiers. In general, language features that are available for classes, and <em>do not break the simple predictable memory layout of a record</em>, are then possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$modeswitch advancedrecords}</span>
<span class="keyword">type</span>
  TMyRecord = <span class="keyword">record</span>
  <span class="directive">public</span>
    I, Square: Integer;
    <span class="keyword">procedure</span> WritelnDescription;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyRecord.WritelnDescription;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Square of </span><span class="delimiter">'</span></span>, I, <span class="string"><span class="delimiter">'</span><span class="content"> is </span><span class="delimiter">'</span></span>, Square);
<span class="keyword">end</span>;

<span class="keyword">var</span>
  A: <span class="keyword">array</span> [<span class="integer">0</span>..<span class="integer">9</span>] <span class="keyword">of</span> TMyRecord;
  R: TMyRecord;
  I: Integer;
<span class="keyword">begin</span>
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> <span class="integer">9</span> <span class="keyword">do</span>
  <span class="keyword">begin</span>
    A[I].I := I;
    A[I].Square := I * I;
  <span class="keyword">end</span>;

  <span class="keyword">for</span> R <span class="keyword">in</span> A <span class="keyword">do</span>
    R.WritelnDescription;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In modern Object Pascal, your first instinct should be to design a <code>class</code>, not a <code>record</code>&#8201;&#8212;&#8201;because classes are packed with useful features, like constructors and inheritance.</p>
</div>
<div class="paragraph">
<p>But records are still very useful when you need speed or a predictable memory layout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Records do not have any constructor or destructor. You just define a variable of a record type. It has undefined contents (memory garbage) at the beginning (except auto-managed types, like strings; they are guaranteed to be initialized to be empty, and finalized to free the reference count). So you have to be more careful when dealing with records, but it gives you some performance gain.</p>
</li>
<li>
<p>Arrays of records are nicely linear in memory, so they are cache-friendly.</p>
</li>
<li>
<p>The memory layout of records (size, padding between fields) is clearly defined in some situations: when you request the <em>C layout</em>, or when you use <code>packed record</code>. This is useful:</p>
<div class="ulist">
<ul>
<li>
<p>to communicate with libraries written in other programming languages, when they expose an API based on records,</p>
</li>
<li>
<p>to read and write binary files,</p>
</li>
<li>
<p>to make dirty low-level tricks (like unsafe typecasting one type to another, being aware of their memory representation).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Records can also have <code>case</code> parts, which work like <em>unions</em> in C-like languages. They allows to treat the same memory piece as a different type, depending on your needs. As such, this allows for greater memory efficiency in some cases. And it allows for more <em>dirty, low-level unsafe tricks</em>:)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_old_style_objects">7.7. Old-style objects</h3>
<div class="paragraph">
<p>In the old days, Turbo Pascal introduced another syntax for class-like functionality, using the <code>object</code> keyword. It&#8217;s somewhat of a blend between the concept of a <code>record</code> and a modern <code>class</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The old-style objects can be allocated / freed, and during that operation you can call their constructor / destructor.</p>
</li>
<li>
<p>But they can also be simply declared and used, like records. A simple <code>record</code> or <code>object</code> type is not a reference (pointer) to something, it&#8217;s simply the data. This makes them comfortable for small data, where calling allocation / free would be bothersome.</p>
</li>
<li>
<p>Old-style objects offer inheritance and virtual methods, although with small differences from the modern classes. Be careful&#8201;&#8212;&#8201;<em>bad things</em> will happen if you try to use an object without calling it&#8217;s constructor, and the object has virtual methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s discouraged to use the old-style objects in most cases. Modern <em>classes</em> provide much more functionality. And when needed, records (including <em>advanced records</em>) can be used for performance. These concepts are usually a better idea than old-style objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pointers">7.8. Pointers</h3>
<div class="paragraph">
<p>You can create a <em>pointer</em> to any other type. The pointer to type <code>TMyRecord</code> is declared as <code>^TMyRecord</code>, and by convention is called <code>PMyRecord</code>. This is a traditional example of a linked list of integers using records:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  PMyRecord = ^TMyRecord;
  TMyRecord = <span class="keyword">record</span>
    Value: Integer;
    Next: PMyRecord;
  <span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the definition is recursive (type <code>PMyRecord</code> is defined using type <code>TMyRecord</code>, while <code>TMyRecord</code> is defined using <code>PMyRecord</code>). It is allowed to define a pointer type to a <em>not-yet-defined type</em>, as long as it will be resolved within the same <code>type</code> block.</p>
</div>
<div class="paragraph">
<p>You can allocate and free pointers using the <code>New</code> / <code>Dispose</code> methods, or (more low-level, not type-safe) <code>GetMem</code> / <code>FreeMem</code> methods. You dereference the pointer (to access the stuff <em>pointed by</em>) you append the <code>^</code> operator. To make the inverse operation, which is to <em>get a pointer of an existing variable</em>, you prefix it with <code>@</code> operator.</p>
</div>
<div class="paragraph">
<p>There is also an untyped <code>Pointer</code> type, similar to <code>void*</code> in C-like languages. It is completely unsafe, and can be typecasted to any other pointer type.</p>
</div>
<div class="paragraph">
<p>Remember that a <em>class instance</em> is also in fact a pointer, although it doesn&#8217;t require any <code>^</code> or <code>@</code> operators to use it.
A linked list using classes is certainly possible, it would simply be this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    Value: Integer;
    Next: TMyClass;
  <span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operator_overloading">7.9. Operator overloading</h3>
<div class="paragraph">
<p>You can override the meaning of many language operators, for example to allow addition and multiplication of your custom types. Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> StrUtils;

operator* (<span class="keyword">const</span> S: <span class="keyword">string</span>; <span class="keyword">const</span> A: Integer): <span class="keyword">string</span>;
<span class="keyword">begin</span>
  Result := DupeString(S, A);
<span class="keyword">end</span>;

<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">bla</span><span class="delimiter">'</span></span> * <span class="integer">10</span>);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override operators on classes too. Since you usually create new instances of your classes inside the operator function, the caller must remember to free the result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
    MyInt: Integer;
  <span class="keyword">end</span>;

operator* (<span class="keyword">const</span> C1, C2: TMyClass): TMyClass;
<span class="keyword">begin</span>
  Result := TMyClass.Create;
  Result.MyInt := C1.MyInt * C2.MyInt;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C1, C2: TMyClass;
<span class="keyword">begin</span>
  C1 := TMyClass.Create;
  <span class="keyword">try</span>
    C1.MyInt := <span class="integer">12</span>;
    C2 := C1 * C1;
    <span class="keyword">try</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">12 * 12 = </span><span class="delimiter">'</span></span>, C2.MyInt);
    <span class="keyword">finally</span> FreeAndNil(C2) <span class="keyword">end</span>;
  <span class="keyword">finally</span> FreeAndNil(C1) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override operators on records too. This is usually easier than overloading them for classes, as the caller doesn&#8217;t have to deal then with memory management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TMyRecord = <span class="keyword">record</span>
    MyInt: Integer;
  <span class="keyword">end</span>;

operator* (<span class="keyword">const</span> C1, C2: TMyRecord): TMyRecord;
<span class="keyword">begin</span>
  Result.MyInt := C1.MyInt * C2.MyInt;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  R1, R2: TMyRecord;
<span class="keyword">begin</span>
  R1.MyInt := <span class="integer">12</span>;
  R2 := R1 * R1;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">12 * 12 = </span><span class="delimiter">'</span></span>, R2.MyInt);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>For records, it&#8217;s adviced to use <code>{$modeswitch advancedrecords}</code> and override operators as <code>class operator</code> inside the record. This allows to use generic classes that depend on some operator existence (like <code>TFPGList</code>, that depends on equality operator being available) with such records. Otherwise the "global" definition of an operator (not inside the record) would not be found (because it&#8217;s not available at the code that implements the <code>TFPGList</code>), and you could not specialize a list like <code>specialize TFPGList&lt;TMyRecord&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$modeswitch advancedrecords}</span>
<span class="keyword">uses</span> SysUtils, FGL;

<span class="keyword">type</span>
  TMyRecord = <span class="keyword">record</span>
    MyInt: Integer;
    <span class="keyword">class</span> operator+ (<span class="keyword">const</span> C1, C2: TMyRecord): TMyRecord;
    <span class="keyword">class</span> operator= (<span class="keyword">const</span> C1, C2: TMyRecord): boolean;
  <span class="keyword">end</span>;

<span class="keyword">class</span> operator TMyRecord.+ (<span class="keyword">const</span> C1, C2: TMyRecord): TMyRecord;
<span class="keyword">begin</span>
  Result.MyInt := C1.MyInt + C2.MyInt;
<span class="keyword">end</span>;

<span class="keyword">class</span> operator TMyRecord.= (<span class="keyword">const</span> C1, C2: TMyRecord): boolean;
<span class="keyword">begin</span>
  Result := C1.MyInt = C2.MyInt;
<span class="keyword">end</span>;

<span class="keyword">type</span>
  TMyRecordList = specialize TFPGList&lt;TMyRecord&gt;;

<span class="keyword">var</span>
  R, ListItem: TMyRecord;
  L: TMyRecordList;
<span class="keyword">begin</span>
  L := TMyRecordList.Create;
  <span class="keyword">try</span>
    R.MyInt := <span class="integer">1</span>;   L.Add(R);
    R.MyInt := <span class="integer">10</span>;  L.Add(R);
    R.MyInt := <span class="integer">100</span>; L.Add(R);

    R.MyInt := <span class="integer">0</span>;
    <span class="keyword">for</span> ListItem <span class="keyword">in</span> L <span class="keyword">do</span>
      R := ListItem + R;

    Writeln(<span class="string"><span class="delimiter">'</span><span class="content">1 + 10 + 100 = </span><span class="delimiter">'</span></span>, R.MyInt);
  <span class="keyword">finally</span> FreeAndNil(L) <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_classes_features">8. Advanced classes features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_private_and_strict_private">8.1. private and strict private</h3>
<div class="paragraph">
<p>The <code>private</code> visibility specifier means that the field (or method) is not accessible outside of this class. But it allows an exception: all the code defined <em>in the same unit</em> can break this, and access private fields and methods. A C++ programmer would say that in Pascal <em>all classes within a single unit are friends</em>. This is often useful, and doesn&#8217;t break your encapsulation, since it&#8217;s limited to a unit.</p>
</div>
<div class="paragraph">
<p>However, if you create larger units, with many classes (that are not tightly integrated with each other), it&#8217;s safer to use <code>strict private</code>. As you can guess, it means that the field (or method) in not accessible outside of this class&#8201;&#8212;&#8201;period. No exceptions.</p>
</div>
<div class="paragraph">
<p>In a similar manner, there&#8217;s <code>protected</code> visibility (visible to descendants, or friends in the same unit) and <code>strict protected</code> (visible to descendants, period).</p>
</div>
</div>
<div class="sect2">
<h3 id="_more_stuff_inside_classes_and_nested_classes">8.2. More stuff inside classes and nested classes</h3>
<div class="paragraph">
<p>You can open a section of constants (<code>const</code>) or types (<code>type</code>) within a class. This way, you can even define a class within a class. The visibility specifiers work as always, in particular the nested class can be private (not visible to the outside world), which is often useful.</p>
</div>
<div class="paragraph">
<p>Note that to declare a field after a constant or type you will need to open a <code>var</code> block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
  <span class="directive">private</span>
    <span class="keyword">type</span>
      TInternalClass = <span class="keyword">class</span>
        Velocity: Single;
        <span class="keyword">procedure</span> DoSomething;
      <span class="keyword">end</span>;
    <span class="keyword">var</span>
    FInternalClass: TInternalClass;
  <span class="directive">public</span>
    <span class="keyword">const</span>
      DefaultVelocity = <span class="integer">10</span><span class="float">0.0</span>;
    <span class="keyword">constructor</span> Create;
    <span class="keyword">destructor</span> Destroy; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TMyClass.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  FInternalClass := TInternalClass.Create;
  FInternalClass.Velocity := DefaultVelocity;
  FInternalClass.DoSomething;
<span class="keyword">end</span>;

<span class="keyword">destructor</span> TMyClass.Destroy;
<span class="keyword">begin</span>
  FreeAndNil(FInternalClass);
  <span class="keyword">inherited</span>;
<span class="keyword">end</span>;

<span class="comment">{ note that method definition is prefixed with
  &quot;TMyClass.TInternalClass&quot; below. }</span>
<span class="keyword">procedure</span> TMyClass.TInternalClass.DoSomething;
<span class="keyword">begin</span>
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_class_methods">8.3. Class methods</h3>
<div class="paragraph">
<p>These are methods you can call having a class reference (<code>TMyClass</code>), not necessarily a class instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TEnemy = <span class="keyword">class</span>
    <span class="keyword">procedure</span> Kill;
    <span class="keyword">class</span> <span class="keyword">procedure</span> KillAll;
  <span class="keyword">end</span>;

<span class="keyword">var</span>
  E: TEnemy;
<span class="keyword">begin</span>
  E := TEnemy.Create;
  <span class="keyword">try</span>
    E.Kill;
  <span class="keyword">finally</span> FreeAndNil(E) <span class="keyword">end</span>;
  TEnemy.KillAll;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that they can be virtual&#8201;&#8212;&#8201;it makes sense, and is sometimes very useful, when combined with <a href="#_class_references">Class references</a>.</p>
</div>
<div class="paragraph">
<p>The class methods can also be limited by the <a href="#_visibility_specifiers">Visibility specifiers</a>, like <code>private</code> or <code>protected</code>. Just like regular methods.</p>
</div>
<div class="paragraph">
<p>Note that a constructor always acts like a class method when called in a normal fashion (<code>MyInstance := TMyClass.Create(&#8230;&#8203;);</code>). Although it&#8217;s possible to also call a constructor from within the class itself, like a normal method, and then it acts like a normal method. This is a useful feature to "chain" constructors, when one constructor (e.g. overloaded to take an integer parameter) does some job, and then calls another constructor (e.g. parameter-less).</p>
</div>
</div>
<div class="sect2">
<h3 id="_class_references">8.4. Class references</h3>
<div class="paragraph">
<p><em>Class reference</em> allows you to choose the class at runtime, for example to call a class method or constructor without knowing the exact class at compile-time. It is a type declared as <code>class of TMyClass</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>(TComponent)
  <span class="keyword">end</span>;

  TMyClass1 = <span class="keyword">class</span>(TMyClass)
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TMyClass)
  <span class="keyword">end</span>;

  TMyClassRef = <span class="keyword">class</span> <span class="keyword">of</span> TMyClass;

<span class="keyword">var</span>
  C: TMyClass;
  ClassRef: TMyClassRef;
<span class="keyword">begin</span>
  <span class="comment">// Obviously you can do this:</span>

  C := TMyClass.Create(<span class="keyword">nil</span>); FreeAndNil(C);
  C := TMyClass1.Create(<span class="keyword">nil</span>); FreeAndNil(C);
  C := TMyClass2.Create(<span class="keyword">nil</span>); FreeAndNil(C);

  <span class="comment">// In addition, using class references, you can also do this:</span>

  ClassRef := TMyClass;
  C := ClassRef.Create(<span class="keyword">nil</span>); FreeAndNil(C);

  ClassRef := TMyClass1;
  C := ClassRef.Create(<span class="keyword">nil</span>); FreeAndNil(C);

  ClassRef := TMyClass2;
  C := ClassRef.Create(<span class="keyword">nil</span>); FreeAndNil(C);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Class references can be combined with virtual class methods. This gives a similar effect as using classes with virtual methods&#8201;&#8212;&#8201;the actual method to be executed is determined at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>(TComponent)
    <span class="keyword">class</span> <span class="keyword">procedure</span> DoSomething; <span class="directive">virtual</span>; <span class="directive">abstract</span>;
  <span class="keyword">end</span>;

  TMyClass1 = <span class="keyword">class</span>(TMyClass)
    <span class="keyword">class</span> <span class="keyword">procedure</span> DoSomething; <span class="directive">override</span>;
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TMyClass)
    <span class="keyword">class</span> <span class="keyword">procedure</span> DoSomething; <span class="directive">override</span>;
  <span class="keyword">end</span>;

  TMyClassRef = <span class="keyword">class</span> <span class="keyword">of</span> TMyClass;

<span class="keyword">var</span>
  C: TMyClass;
  ClassRef: TMyClassRef;
<span class="keyword">begin</span>
  ClassRef := TMyClass1;
  ClassRef.DoSomething;

  ClassRef := TMyClass2;
  ClassRef.DoSomething;

  <span class="comment">{ And this will cause an exception at runtime,
    since DoSomething is abstract in TMyClass. }</span>
  ClassRef := TMyClass;
  ClassRef.DoSomething;
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have an instance, and you would like to get a reference to it&#8217;s class (not the declared class, but the final descendant class used at its construction), you can use the <code>ClassType</code> property. The declared type of <code>ClassType</code> is <code>TClass</code>, which stands for <code>class of TObject</code>. Often you can safely typecast it to something more specific, when you know that the instance is something more specific than <code>TObject</code>.</p>
</div>
<div class="paragraph">
<p>In particular, you can use the <code>ClassType</code> reference to call virtual methods, including virtual constructors. This allows you to create a method like <code>Clone</code> that constructs an instance of <em>the exact run-time class of the current object</em>. You can combine it with <a href="#_cloning_tpersistent_assign">Cloning: TPersistent.Assign</a> to have a method that returns a newly-constructed clone of the current instance.</p>
</div>
<div class="paragraph">
<p>Remember that it only works when the constructor of your class is virtual. For example, it can be used with the standard <code>TComponent</code> descendants, since they all must override <code>TComponent.Create(AOwner: TComponent)</code> virtual constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>(TComponent)
    <span class="keyword">procedure</span> Assign(Source: TPersistent); <span class="directive">override</span>;
    <span class="keyword">function</span> Clone(AOwner: TComponent): TMyClass;
  <span class="keyword">end</span>;

  TMyClassRef = <span class="keyword">class</span> <span class="keyword">of</span> TMyClass;

<span class="keyword">function</span> TMyClass.Clone(AOwner: TComponent): TMyClass;
<span class="keyword">begin</span>
  <span class="comment">// This would always create an instance of exactly TMyClass:</span>
  <span class="comment">//Result := TMyClass.Create(AOwner);</span>
  <span class="comment">// This can potentially create an instance of TMyClass descendant:</span>
  Result := TMyClassRef(ClassType).Create(AOwner);
  Result.Assign(Self);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_class_methods">8.5. Static class methods</h3>
<div class="paragraph">
<p>To understand the <em>static class methods</em>, you have to understand how the <em>normal class methods</em> (described in the previous sections) work. Internally, <em>normal class methods</em> receive a <em>class reference</em> of their class (it is passed through a hidden, implicitly added 1st parameter of the method). This class reference can be even accessed explicitly using the <code>Self</code> keyword inside the class method. Usually, it&#8217;s a good thing: this class reference allows you to call <em>virtual class methods</em> (through the <em>virtual method table</em> of the class).</p>
</div>
<div class="paragraph">
<p>While this is nice, it makes the <em>normal class methods</em> incompatible when assigning to a <em>global procedure pointer</em>. That is, <strong>this will not compile</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">type</span>
  TMyCallback = <span class="keyword">procedure</span> (A: Integer);

  TMyClass = <span class="keyword">class</span>
    <span class="keyword">class</span> <span class="keyword">procedure</span> Foo(A: Integer);
  <span class="keyword">end</span>;

<span class="keyword">class</span> <span class="keyword">procedure</span> TMyClass.Foo(A: Integer);
<span class="keyword">begin</span>
<span class="keyword">end</span>;

<span class="keyword">var</span>
  Callback: TMyCallback;
<span class="keyword">begin</span>
  <span class="comment">// Error: TMyClass.Foo not compatible with TMyCallback</span>
  Callback := @TMyClass(<span class="keyword">nil</span>).Foo;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the <em>Delphi mode</em> you would be able to write <code>TMyClass.Foo</code> instead of an ugly <code>TMyClass(nil).Foo</code> in the example above. Admittedly, the <code>TMyClass.Foo</code> looks much more elegant, and it is also better checked by the compiler. Using the <code>TMyClass(nil).Foo</code> is a hack&#8230;&#8203; unfortunately, necessary (for now) in the <em>ObjFpc mode</em> which is presented throughout this book.</p>
</div>
<div class="paragraph">
<p>In any case, assigning the <code>TMyClass.Foo</code> to the <code>Callback</code> above would <em>still fail</em> in the Delphi mode, for exactly the same reasons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example fails to compile, because the <code>Callback</code> is incompatible with the class method <code>Foo</code>. And it&#8217;s incompatible because internally the class method has that special hidden <em>implicit</em> parameter to pass a class reference.</p>
</div>
<div class="paragraph">
<p>One way to fix the above example is to change the definition of <code>TMyCallback</code>. It will work if it is a method callback, declared as <code>TMyCallback = procedure (A: Integer) of object;</code>. But sometimes, it&#8217;s not desirable.</p>
</div>
<div class="paragraph">
<p>Here comes the <code>static</code> class method. It is, in essence, just a global procedure / function, but it&#8217;s namespace is limited inside the class. It <em>does not</em> have any implicit class reference (and so, <em>it cannot be virtual</em> and <em>it cannot call virtual class methods</em>). On the upside, it is compatible with normal (non-object) callbacks. So this will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">type</span>
  TMyCallback = <span class="keyword">procedure</span> (A: Integer);

  TMyClass = <span class="keyword">class</span>
    <span class="keyword">class</span> <span class="keyword">procedure</span> Foo(A: Integer); static;
  <span class="keyword">end</span>;

<span class="keyword">class</span> <span class="keyword">procedure</span> TMyClass.Foo(A: Integer);
<span class="keyword">begin</span>
<span class="keyword">end</span>;

<span class="keyword">var</span>
  Callback: TMyCallback;
<span class="keyword">begin</span>
  Callback := @TMyClass.Foo;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_class_properties_and_variables">8.6. Class properties and variables</h3>
<div class="paragraph">
<p>A <em>class property</em> is a property that can be accessed through a class reference (it does not need a class instance).</p>
</div>
<div class="paragraph">
<p>It is quite straightforward analogy of a regular property (see <a href="#_properties">Properties</a>). For a <em>class property</em>, you define a <em>getter</em> and / or a <em>setter</em>. They may refer to a <em>class variable</em> or a <em>static class method</em>.</p>
</div>
<div class="paragraph">
<p>A <em>class variable</em> is, you guessed it, like a regular field but you don&#8217;t need a class instance to access it. In effect, it&#8217;s just like a global variable, but with the namespace limited to the containing class. It can be declared within the <code>class var</code> section of the class. Alternatively
it can be declared by following the normal field definition with the keyword <code>static</code>.</p>
</div>
<div class="paragraph">
<p>And a <em>static class method</em> is just like a global procedure / function, but with the namespace limited to the containing class. More about static class methods in the section above, see <a href="#_static_class_methods">Static class methods</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">type</span>
  TMyClass = <span class="keyword">class</span>
  strict <span class="directive">private</span>
    <span class="comment">// Alternative:</span>
    <span class="comment">// FMyProperty: Integer; static;</span>
    <span class="keyword">class</span> <span class="keyword">var</span>
      FMyProperty: Integer;
    <span class="keyword">class</span> <span class="keyword">procedure</span> SetMyProperty(<span class="keyword">const</span> Value: Integer); static;
  <span class="directive">public</span>
    <span class="keyword">class</span> <span class="keyword">property</span> MyProperty: Integer
      <span class="directive">read</span> FMyProperty <span class="directive">write</span> SetMyProperty;
  <span class="keyword">end</span>;

<span class="keyword">class</span> <span class="keyword">procedure</span> TMyClass.SetMyProperty(<span class="keyword">const</span> Value: Integer);
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">MyProperty changes!</span><span class="delimiter">'</span></span>);
  FMyProperty := Value;
<span class="keyword">end</span>;

<span class="keyword">begin</span>
  TMyClass.MyProperty := <span class="integer">123</span>;
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass.MyProperty is now </span><span class="delimiter">'</span></span>, TMyClass.MyProperty);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_class_helpers">8.7. Class helpers</h3>
<div class="paragraph">
<p>The <em>method</em> is just a procedure or function inside a class. From the outside of the class, you call it with a special syntax <code>MyInstance.MyMethod(&#8230;&#8203;)</code>. After a while you grow accustomed to thinking that <em>if I want to make action Action on instance X, I write `X.Action(&#8230;&#8203;)`</em>.</p>
</div>
<div class="paragraph">
<p>But sometimes, you need to implement something that conceptually is <em>an action on class TMyClass</em> without modifying the <em>TMyClass</em> source code. Sometimes it&#8217;s because it&#8217;s not your source code, and you don&#8217;t want to change it. Sometimes it&#8217;s because of the dependencies&#8201;&#8212;&#8201;adding a method like <code>Render</code> to a class like <code>TMy3DObject</code> seems like a straightforward idea, but maybe the base implementation of class <code>TMy3DObject</code> should be kept independent from the rendering code? It would be better to "enhance" an existing class, to add functionality to it without changing it&#8217;s source code.</p>
</div>
<div class="paragraph">
<p>Simple way to do it is then to create a global procedure that takes an instance of <code>TMy3DObject</code> as it&#8217;s 1st parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">procedure</span> Render(<span class="keyword">const</span> O: TMy3DObject; <span class="keyword">const</span> Color: TColor);
<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> O.ShapesCount - <span class="integer">1</span> <span class="keyword">do</span>
    RenderMesh(O.Shape[I].Mesh, Color);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works perfectly, but the downside is that calling it looks a little ugly. While usually you call actions like <code>X.Action(&#8230;&#8203;)</code>, in this case you have to call them like <code>Render(X, &#8230;&#8203;)</code>. It would be cool to be able to just write <code>X.Render(&#8230;&#8203;)</code>, even when <code>Render</code> is not implemented in the same unit as <code>TMy3DObject</code>.</p>
</div>
<div class="paragraph">
<p>And this is where you use class helpers. They are just a way to implement procedures / functions that operate on given class, and that are called like methods, but are not in fact normal methods&#8201;&#8212;&#8201;they were added outside of the <code>TMy3DObject</code> definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="keyword">type</span>
  TMy3DObjectHelper = <span class="keyword">class</span> helper <span class="keyword">for</span> TMy3DObject
    <span class="keyword">procedure</span> Render(<span class="keyword">const</span> Color: TColor);
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMy3DObjectHelper.Render(<span class="keyword">const</span> Color: TColor);
<span class="keyword">var</span>
  I: Integer;
<span class="keyword">begin</span>
  <span class="comment">// note that we access ShapesCount, Shape without any qualifiers here</span>
  <span class="keyword">for</span> I := <span class="integer">0</span> <span class="keyword">to</span> ShapesCount - <span class="integer">1</span> <span class="keyword">do</span>
    RenderMesh(Shape[I].Mesh, Color);
<span class="keyword">end</span>;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The more general concept is <em>"type helper"</em>. Using them you can add methods even to primitive types, like integers or enums. You can also add <em>"record helpers</em>" to (you guessed it&#8230;&#8203;) records. See <a href="http://lists.freepascal.org/fpc-announce/2013-February/000587.html" class="bare">http://lists.freepascal.org/fpc-announce/2013-February/000587.html</a> .
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_constructors_destructors">8.8. Virtual constructors, destructors</h3>
<div class="paragraph">
<p>Destructor name is always <code>Destroy</code>, it is virtual (since you can call it without knowing the exact class at compile-time) and parameter-less.</p>
</div>
<div class="paragraph">
<p>Constructor name is by convention <code>Create</code>.</p>
</div>
<div class="paragraph">
<p>You can change this name, although be careful with this&#8201;&#8212;&#8201;if you define <code>CreateMy</code>, always redefine also the name <code>Create</code>, otherwise the user can still access the constructor <code>Create</code> of the ancestor, bypassing your <code>CreateMy</code> constructor.</p>
</div>
<div class="paragraph">
<p>In the base <code>TObject</code> it is not virtual, and when creating descendants you&#8217;re free to change the parameters. The new constructor will hide the constructor in ancestor (note: don&#8217;t put here <code>overload</code>, unless you want to break it).</p>
</div>
<div class="paragraph">
<p>In the <code>TComponent</code> descendants, you should override it&#8217;s <code>constructor Create(AOwner: TComponent);</code>. For streaming functionality, to create a class without knowing it&#8217;s type at compile time, having virtual constructors is very useful (see "class references" below).</p>
</div>
</div>
<div class="sect2">
<h3 id="_an_exception_in_constructor">8.9. An exception in constructor</h3>
<div class="paragraph">
<p>What happens if an exception happens during a constructor? The line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">X := TMyClass.Create;</code></pre>
</div>
</div>
<div class="paragraph">
<p>does not execute to the end in this case, <code>X</code> cannot be assigned, so who will cleanup after a partially-constructed class?</p>
</div>
<div class="paragraph">
<p>The solution of Object Pascal is that, in case an exception occurs within a constructor, then the destructor is called. This is a reason why <em>your destructor must be robust</em>, which means it should work in any circumstances, even on a half-created class instance. Usually this is easy if you release everything safely, like by <code>FreeAndNil</code>.</p>
</div>
<div class="paragraph">
<p>We also have to depend in such cases that <em>the memory of the class is guaranteed to be zeroed right before the constructor code is executed</em>. So we know that at the beginning, all class references are <code>nil</code>, all integers are <code>0</code> and so on.</p>
</div>
<div class="paragraph">
<p>So below works without any memory leaks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;

<span class="keyword">type</span>
  TGun = <span class="keyword">class</span>
  <span class="keyword">end</span>;

  TPlayer = <span class="keyword">class</span>
    Gun1, Gun2: TGun;
    <span class="keyword">constructor</span> Create;
    <span class="keyword">destructor</span> Destroy; <span class="directive">override</span>;
  <span class="keyword">end</span>;

<span class="keyword">constructor</span> TPlayer.Create;
<span class="keyword">begin</span>
  <span class="keyword">inherited</span>;
  Gun1 := TGun.Create;
  <span class="keyword">raise</span> Exception.Create(<span class="string"><span class="delimiter">'</span><span class="content">Raising an exception from constructor!</span><span class="delimiter">'</span></span>);
  Gun2 := TGun.Create;
<span class="keyword">end</span>;

<span class="keyword">destructor</span> TPlayer.Destroy;
<span class="keyword">begin</span>
  <span class="comment">{ in case since the constructor crashed, we can
    have Gun1 &lt;&gt; nil and Gun2 = nil now. Deal with it.
    ...Actually, in this case, FreeAndNil deals with it without
    any additional effort on our side, because FreeAndNil checks
    whether the instance is nil before calling it's destructor. }</span>
  FreeAndNil(Gun1);
  FreeAndNil(Gun2);
  <span class="keyword">inherited</span>;
<span class="keyword">end</span>;

<span class="keyword">begin</span>
  <span class="keyword">try</span>
    TPlayer.Create;
  <span class="keyword">except</span>
    <span class="directive">on</span> E: Exception <span class="keyword">do</span>
      Writeln(<span class="string"><span class="delimiter">'</span><span class="content">Caught </span><span class="delimiter">'</span></span> + E.ClassName + <span class="string"><span class="delimiter">'</span><span class="content">: </span><span class="delimiter">'</span></span> + E.Message);
  <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interfaces">9. Interfaces</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bare_corba_interfaces">9.1. Bare (CORBA) interfaces</h3>
<div class="paragraph">
<p><em>An interface</em> declares an API, much like a class, but it does not define the implementation. A class can implement many interfaces, but it can only have one ancestor class.</p>
</div>
<div class="paragraph">
<p>You can cast a class to any interface it supports, and then <em>call the methods through that interface</em>. This allows to treat in a uniform fashion the classes that don&#8217;t descend from each other, but still share some common functionality. Useful when a simple class inheritance is not enough.</p>
</div>
<div class="paragraph">
<p>The <em>CORBA interfaces</em> in Object Pascal work pretty much like interfaces in Java (<a href="https://docs.oracle.com/javase/tutorial/java/concepts/interface.html" class="bare">https://docs.oracle.com/javase/tutorial/java/concepts/interface.html</a>) or C# (<a href="https://msdn.microsoft.com/en-us/library/ms173156.aspx" class="bare">https://msdn.microsoft.com/en-us/library/ms173156.aspx</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$interfaces corba}</span>

<span class="keyword">uses</span> SysUtils, Classes;

<span class="keyword">type</span>
  IMyInterface = <span class="keyword">interface</span>
  [<span class="string"><span class="delimiter">'</span><span class="content">{79352612-668B-4E8C-910A-26975E103CAC}</span><span class="delimiter">'</span></span>]
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass1 = <span class="keyword">class</span>(IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass3 = <span class="keyword">class</span>
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass1.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass3.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass3.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> UseThroughInterface(I: IMyInterface);
<span class="keyword">begin</span>
  <span class="directive">Write</span>(<span class="string"><span class="delimiter">'</span><span class="content">Shooting... </span><span class="delimiter">'</span></span>);
  I.Shoot;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C1: TMyClass1;
  C2: TMyClass2;
  C3: TMyClass3;
<span class="keyword">begin</span>
  C1 := TMyClass1.Create;
  C2 := TMyClass2.Create;
  C3 := TMyClass3.Create;
  <span class="keyword">try</span>
    <span class="keyword">if</span> C1 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
      UseThroughInterface(C1 <span class="keyword">as</span> IMyInterface);
    <span class="keyword">if</span> C2 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
      UseThroughInterface(C2 <span class="keyword">as</span> IMyInterface);
    <span class="comment">// The &quot;C3 is IMyInterface&quot; below is false,</span>
    <span class="comment">// so &quot;UseThroughInterface(C3 as IMyInterface)&quot; will not execute.</span>
    <span class="keyword">if</span> C3 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
      UseThroughInterface(C3 <span class="keyword">as</span> IMyInterface);
  <span class="keyword">finally</span>
    FreeAndNil(C1);
    FreeAndNil(C2);
    FreeAndNil(C3);
  <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_corba_and_com_types_of_interfaces">9.2. CORBA and COM types of interfaces</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Why are the interfaces (presented above) called "CORBA"?</dt>
<dd>
<p>The name <strong>CORBA</strong> is unfortunate. A better name would be <strong>bare interfaces</strong>. These interfaces are a <em>"pure language feature"</em>. Use them when you want to cast various classes as the same interface, because they share a common API.</p>
<div class="paragraph">
<p>While these types of interfaces can be used together with the <em>CORBA (Common Object Request Broker Architecture) technology</em> (see <a href="https://en.wikipedia.org/wiki/Common_Object_Request_Broker_Architecture" class="bare">https://en.wikipedia.org/wiki/Common_Object_Request_Broker_Architecture</a>), they are <em>not</em> tied to this technology in any way.</p>
</div>
</dd>
<dt class="hdlist1">Is the <code>{$interfaces corba}</code> declaration needed?</dt>
<dd>
<p>Yes, because by default
you create <em>COM interfaces</em>. This can be stated explicitly by saying <code>{$interfaces com}</code>, but usually it&#8217;s not needed since it&#8217;s the default state.</p>
<div class="paragraph">
<p>And I don&#8217;t advice using <em>COM interfaces</em>, especially if you&#8217;re looking for something equivalent to interfaces from other programming languages. The <em>CORBA interfaces</em> in Pascal are exactly what you expect if you&#8217;re looking for something equivalent to the interfaces in C# and Java. While the <em>COM interfaces</em> bring additional features that you possibly don&#8217;t want.</p>
</div>
<div class="paragraph">
<p>Note that the <code>{$interfaces xxx}</code> declaration only affects the interfaces that do not have any explicit ancestor (just the keyword <code>interface</code>, not <code>interface(ISomeAncestor)</code>). When an interface has an ancestor, it has the same type as the ancestor, regardless of the <code>{$interfaces xxx}</code> declaration.</p>
</div>
</dd>
<dt class="hdlist1">What are COM interfaces?</dt>
<dd>
<p>The <em>COM interface</em> is synonymous with <em>an interface descending from a special <code>IUnknown</code> interface</em>. Descending from <code>IUnknown</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Requires that your classes define the <code>_AddRef</code> and <code>_ReleaseRef</code> methods. Proper implementation of these methods can manage the lifetime of your objects using the reference-counting.</p>
</li>
<li>
<p>Adds the <code>QueryInterface</code> method.</p>
</li>
<li>
<p>Allows to interact with the <em>COM (Component Object Model) technology</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Why do you advice to not use the COM interfaces?</dt>
<dd>
<p>Because <em>COM interfaces</em> "entangle" two features that should be unrelated (orthogonal) in my view: <em>multiple inheritance</em> and <em>reference counting</em>. Other programming languages rightly use separate concepts for these two features.</p>
<div class="paragraph">
<p>To be clear: <strong>reference-counting</strong>, that provides an automatic memory management (in simple situations, i.e. without cycles), <strong>is a very useful concept</strong>. But <strong>entangling this feature with interfaces (instead of making them orthogonal features) is unclean in my eyes</strong>. It definitely doesn&#8217;t match my use cases.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Sometimes I want to cast my (otherwise unrelated) classes to a common interface.</p>
</li>
<li>
<p>Sometimes I want to manage memory using the reference counting approach.</p>
</li>
<li>
<p><em>Maybe</em> some day I will want to interact with the <em>COM technology</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>But these are all separate, unrelated needs. Entangling them in a single language feature is counter-useful in my experience. It does cause actual problems:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If I want the feature of <em>casting classes to a common interface API</em>, but I don&#8217;t want the reference-counting mechanism (I want to manually free objects), then the COM interfaces are problematic. Even when reference-counting is disabled by a special <code>_AddRef</code> and <code>_ReleaseRef</code> implementation, you still need to be careful to never have a temporary interface reference hanging, after you have freed the class instance. More details about it in the next section.</p>
</li>
<li>
<p>If I want the feature of <em>reference counting</em>, but I have no need for an interface hierarchy to represent something different than the class hierarchy, then I have to duplicate my classes API in interfaces. Thus creating a single interface for each class. This is counter-productive. I would much rather have <em>smart pointers</em> as a separate language feature, not entangled with interfaces (and luckily, it&#8217;s coming:).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>That is why I advice to use <em>CORBA</em> style interfaces, and the <code>{$interfaces corba}</code> directive, in all modern code dealing with interfaces.</p>
</div>
<div class="paragraph">
<p><em>Only if you need both "reference counting" and "multiple inheritance" at the same time, then use COM interfaces</em>. Also, Delphi has only COM interfaces for now, so you need to use COM interfaces if your code must be compatible with Delphi.</p>
</div>
</dd>
<dt class="hdlist1">Can we have reference-counting with CORBA interfaces?</dt>
<dd>
<p>Yeah. Just add <code>_AddRef</code> / <code>_ReleaseRef</code> methods. There&#8217;s no need to descend from the <code>IUnknown</code> interface. Although in most cases, if you want reference-counting with your interfaces, you may as well just use COM interfaces.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_interfaces_guids">9.3. Interfaces GUIDs</h3>
<div class="paragraph">
<p>GUIDs are the seemingly random characters <code>['{ABCD1234-&#8230;&#8203;}']</code> that you see placed at every interface definition. Yes, they are just random. Unfortunately, they are necessary.</p>
</div>
<div class="paragraph">
<p>The GUIDs have no meaning if you don&#8217;t plan on integrating with communication technologies like <em>COM</em> nor <em>CORBA</em>. But they are necessary, for implementation reasons. Don&#8217;t be fooled by the compiler, that unfortunately allows you to declare interfaces without GUIDs.</p>
</div>
<div class="paragraph">
<p>Without the (unique) GUIDs, your interfaces will be treated equal by the <code>is</code> operator. In effect, it will return <code>true</code> if your class supports <em>any</em> of your interfaces. The magic function <code>Supports(ObjectInstance, IMyInterface)</code> behaves slightly better here, as it refuses to be compiled for interfaces without a GUID. This is true for both CORBA and COM interfaces, as of FPC 3.0.0.</p>
</div>
<div class="paragraph">
<p>So, to be on the safe side, you should always declare a GUID for your interface. You can use <em>Lazarus</em> GUID generator (<code>Ctrl + Shift + G</code> shortcut in the editor). Or you can use an online service like <a href="https://www.guidgenerator.com/" class="bare">https://www.guidgenerator.com/</a> .</p>
</div>
<div class="paragraph">
<p>Or you can write your own tool for this, using the <code>CreateGUID</code> and <code>GUIDToString</code> functions in RTL. See the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="keyword">uses</span> SysUtils;
<span class="keyword">var</span>
  MyGuid: TGUID;
<span class="keyword">begin</span>
  Randomize;
  CreateGUID(MyGuid);
  Writeln(<span class="char"><span class="delimiter">'</span><span class="content">[</span><span class="delimiter">'</span></span><span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span> + GUIDToString(MyGuid) + <span class="string"><span class="delimiter">'</span><span class="char">''</span><span class="content">]</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reference_counted_com_interfaces">9.4. Reference-counted (COM) interfaces</h3>
<div class="paragraph">
<p>The <em>COM interfaces</em> bring two additional features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>integration with COM (a technology from Windows, also available on Unix through <em>XPCOM</em>, used by Mozilla),</p>
</li>
<li>
<p>reference counting (which gives you automatic destruction when all the interface references go out of scope).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When using <em>COM interfaces</em>, you need to be aware of their <em>automatic destruction</em> mechanism and relation to COM technology.</p>
</div>
<div class="paragraph">
<p>In practice, this means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your class needs to implement a magic <code>_AddRef</code>, <code>_Release</code>, and <code>QueryInterface</code> methods. Or descend from something that already implements them. A particular implementation of these methods may actually enable or disable the <em>reference-counting</em> feature of COM interfaces (although disabling it is somewhat dangerous&#8201;&#8212;&#8201;see the next point).</p>
<div class="ulist">
<ul>
<li>
<p>The standard class <code>TInterfacedObject</code> implements these methods to <em>enable</em> the reference-counting.</p>
</li>
<li>
<p>The standard class <code>TComponent</code> implements these methods to <em>disable</em> the reference-counting. <strong>In the Castle Game Engine</strong> we give you additional useful ancestors <code>TNonRefCountedInterfacedObject</code> and <code>TNonRefCountedInterfacedPersistent</code> for this purpose, see <a href="https://github.com/castle-engine/castle-engine/blob/master/src/base/castleinterfaces.pas" class="bare">https://github.com/castle-engine/castle-engine/blob/master/src/base/castleinterfaces.pas</a> .</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>You need to be careful of freeing the class, when it may be referenced by some interface variables. Because the interface is released using a virtual method (because it <em>may be reference-counted, even if you hack the _AddRef method to not be reference-counted&#8230;&#8203;</em>), you cannot free the underlying object instance as long as some interface variable may point to it. See <em>"7.7 Reference counting"</em> in the FPC manual (<a href="http://freepascal.org/docs-html/ref/refse47.html" class="bare">http://freepascal.org/docs-html/ref/refse47.html</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The safest approach to using <em>COM interfaces</em> is to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>accept the fact that they are reference-counted,</p>
</li>
<li>
<p>derive the appropriate classes from <code>TInterfacedObject</code>,</p>
</li>
<li>
<p>and avoid using the class instance, instead accessing the instance always through the interface, letting reference-counting manage the deallocation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is an example of such interface use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$interfaces com}</span>

<span class="keyword">uses</span> SysUtils, Classes;

<span class="keyword">type</span>
  IMyInterface = <span class="keyword">interface</span>
  [<span class="string"><span class="delimiter">'</span><span class="content">{3075FFCD-8EFB-4E98-B157-261448B8D92E}</span><span class="delimiter">'</span></span>]
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass1 = <span class="keyword">class</span>(TInterfacedObject, IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TInterfacedObject, IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass3 = <span class="keyword">class</span>(TInterfacedObject)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass1.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass3.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass3.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> UseThroughInterface(I: IMyInterface);
<span class="keyword">begin</span>
  <span class="directive">Write</span>(<span class="string"><span class="delimiter">'</span><span class="content">Shooting... </span><span class="delimiter">'</span></span>);
  I.Shoot;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C1: IMyInterface;  <span class="comment">// COM takes care of destruction</span>
  C2: IMyInterface;  <span class="comment">// COM takes care of destruction</span>
  C3: TMyClass3;     <span class="comment">// YOU have to take care of destruction</span>
<span class="keyword">begin</span>
  C1 := TMyClass1.Create <span class="keyword">as</span> IMyInterface;
  C2 := TMyClass2.Create <span class="keyword">as</span> IMyInterface;
  C3 := TMyClass3.Create;
  <span class="keyword">try</span>
    UseThroughInterface(C1); <span class="comment">// no need to use &quot;as&quot; operator</span>
    UseThroughInterface(C2);
    <span class="keyword">if</span> C3 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
      UseThroughInterface(C3 <span class="keyword">as</span> IMyInterface); <span class="comment">// this will not execute</span>
  <span class="keyword">finally</span>
    <span class="comment">{ C1 and C2 variables go out of scope and will be auto-destroyed now.

      In contrast, C3 is a class instance, not managed by an interface,
      and it has to be destroyed manually. }</span>
    FreeAndNil(C3);
  <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_com_interfaces_with_reference_counting_disabled">9.5. Using COM interfaces with reference-counting disabled</h3>
<div class="paragraph">
<p>As mentioned in the previous section, your class can descend from <code>TComponent</code> (or a similar class like <code>TNonRefCountedInterfacedObject</code> and <code>TNonRefCountedInterfacedPersistent</code>) which disables reference-counting for COM interfaces. This allows you to use COM interfaces, and still free the class instance manually.</p>
</div>
<div class="paragraph">
<p>You need to be careful in this case to not free the class instance when some interface variable may refer to it. Remember that every typecast <code>Cx as IMyInterface</code> also creates a temporary interface variable, which may be present even until the end of the current procedure. For this reason, the example below uses a <code>UseInterfaces</code> procedure, and it frees the class instances <em>outside</em> of this procedure (when we can be sure that temporary interface variables are out of scope).</p>
</div>
<div class="paragraph">
<p>To avoid this mess, it&#8217;s usually better to use CORBA interfaces, if you don&#8217;t want reference-counting with your interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal"><span class="preprocessor">{$mode objfpc}</span><span class="preprocessor">{$H+}</span><span class="preprocessor">{$J-}</span>
<span class="preprocessor">{$interfaces com}</span>

<span class="keyword">uses</span> SysUtils, Classes;

<span class="keyword">type</span>
  IMyInterface = <span class="keyword">interface</span>
  [<span class="string"><span class="delimiter">'</span><span class="content">{3075FFCD-8EFB-4E98-B157-261448B8D92E}</span><span class="delimiter">'</span></span>]
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass1 = <span class="keyword">class</span>(TComponent, IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass2 = <span class="keyword">class</span>(TComponent, IMyInterface)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

  TMyClass3 = <span class="keyword">class</span>(TComponent)
    <span class="keyword">procedure</span> Shoot;
  <span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass1.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass1.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass2.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass2.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> TMyClass3.Shoot;
<span class="keyword">begin</span>
  Writeln(<span class="string"><span class="delimiter">'</span><span class="content">TMyClass3.Shoot</span><span class="delimiter">'</span></span>);
<span class="keyword">end</span>;

<span class="keyword">procedure</span> UseThroughInterface(I: IMyInterface);
<span class="keyword">begin</span>
  <span class="directive">Write</span>(<span class="string"><span class="delimiter">'</span><span class="content">Shooting... </span><span class="delimiter">'</span></span>);
  I.Shoot;
<span class="keyword">end</span>;

<span class="keyword">var</span>
  C1: TMyClass1;
  C2: TMyClass2;
  C3: TMyClass3;

<span class="keyword">procedure</span> UseInterfaces;
<span class="keyword">begin</span>
  <span class="keyword">if</span> C1 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
  <span class="comment">//if Supports(C1, IMyInterface) then // equivalent to &quot;is&quot; check above</span>
    UseThroughInterface(C1 <span class="keyword">as</span> IMyInterface);
  <span class="keyword">if</span> C2 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
    UseThroughInterface(C2 <span class="keyword">as</span> IMyInterface);
  <span class="keyword">if</span> C3 <span class="keyword">is</span> IMyInterface <span class="keyword">then</span>
    UseThroughInterface(C3 <span class="keyword">as</span> IMyInterface);
<span class="keyword">end</span>;

<span class="keyword">begin</span>
  C1 := TMyClass1.Create(<span class="keyword">nil</span>);
  C2 := TMyClass2.Create(<span class="keyword">nil</span>);
  C3 := TMyClass3.Create(<span class="keyword">nil</span>);
  <span class="keyword">try</span>
    UseInterfaces;
  <span class="keyword">finally</span>
    FreeAndNil(C1);
    FreeAndNil(C2);
    FreeAndNil(C3);
  <span class="keyword">end</span>;
<span class="keyword">end</span>.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_typecasting_interfaces_without_as_operator">9.6. Typecasting interfaces without "as" operator</h3>
<div class="paragraph">
<p>This section applies to both <em>CORBA</em> and <em>COM</em> interfaces.</p>
</div>
<div class="paragraph">
<p>Casting to an interface type using the <code>as</code> operator makes a check at run-time. Consider this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">UseThroughInterface(Cx <span class="keyword">as</span> IMyInterface);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It works for all <code>C1</code>, <code>C2</code>, <code>C3</code> instances in the examples in previous sections. If executed, it would make a run-time error in case of <code>C3</code>, that does not implement <code>IMyInterface</code> (but we avoid the error by checking <code>Cx is IMyInterface</code> before doing the cast).</p>
</div>
<div class="paragraph">
<p>You can instead cast the instance as an interface implicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">UseThroughInterface(Cx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the typecast must be valid at compile-time. So this will compile for <code>C1</code> and <code>C2</code> (that are declared as classes that implement <code>IMyInterface</code>). But it will not compile for <code>C3</code>.</p>
</div>
<div class="paragraph">
<p>In essence, this typecast looks and works just like for regular classes. Wherever an instance of a class <code>TMyClass</code> is required, you can always use there a variable that is declared with a class of <code>TMyClass</code>, <strong>or <code>TMyClass</code> descendant</strong>. The same rule applies to interfaces. No need for any explicit typecast in such situations.</p>
</div>
<div class="paragraph">
<p>An equivalent is also</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pascal">UseThroughInterface(IMyInterface(Cx));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is also a typecast that must be valid at compile-time. Note that this syntax is inconsistent with classes typecasts. In case of classes, writing <code>TMyClass(C)</code> is an <em>unsafe, unchecked</em> typecast. In case of interfaces, writing <code>IMyInterface(C)</code> is a safe, fast (checked at compile-time) typecast.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_this_document">10. About this document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright Michalis Kamburelis.</p>
</div>
<div class="paragraph">
<p>The source code of this document is in AsciiDoc on <a href="https://github.com/michaliskambi/modern-pascal-introduction" class="bare">https://github.com/michaliskambi/modern-pascal-introduction</a>. Suggestions for corrections and additions, and patches and pull requests, are always very welcome:) You can reach me through GitHub or email <a href="mailto:michalis.kambi@gmail.com">michalis.kambi@gmail.com</a>. My homepage is <a href="https://michalis.ii.uni.wroc.pl/~michalis/" class="bare">https://michalis.ii.uni.wroc.pl/~michalis/</a>. This document is linked under the <em>Documentation</em> section of the <em>Castle Game Engine</em> website <a href="https://castle-engine.sourceforge.io/" class="bare">https://castle-engine.sourceforge.io/</a>.</p>
</div>
<div class="paragraph">
<p>You can redistribute and even modify this document freely, under the same licenses as Wikipedia <a href="https://en.wikipedia.org/wiki/Wikipedia:Copyrights" class="bare">https://en.wikipedia.org/wiki/Wikipedia:Copyrights</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Creative Commons Attribution-ShareAlike 3.0 Unported License (CC BY-SA)</em></p>
</li>
<li>
<p>or the <em>GNU Free Documentation License (GFDL) (unversioned, with no invariant sections, front-cover texts, or back-cover texts)</em> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thank you for reading!</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-01-20 23:35:19 CET
</div>
</div>
<!-- Google analytics -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6792759-1");
pageTracker._trackPageview();
} catch(err) {}</script>

<!-- Piwik -->
<a href="http://piwik.org" title="Web analytics" onclick="window.open(this.href);return(false);">
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://michalis.ii.uni.wroc.pl/piwik/" : "http://michalis.ii.uni.wroc.pl/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p>Web analytics <img src="http://michalis.ii.uni.wroc.pl/piwik/piwik.php?idsite=1" style="border:0" alt=""/></p></noscript></object></a>
<!-- End Piwik Tag -->
</body>
</html>